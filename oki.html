<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dava Yönetim Sistemi Pro v4.5 - Ultra Edition</title>
  
  <!-- External Libraries -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.1.1/dist/tesseract.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ical.js@1.5.0/build/ical.min.js"></script>
  
  <style>
    :root {
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --primary-light: #818cf8;
      --secondary: #8b5cf6;
      --secondary-dark: #7c3aed;
      --success: #10b981;
      --success-dark: #059669;
      --danger: #ef4444;
      --danger-dark: #dc2626;
      --warning: #f59e0b;
      --warning-dark: #d97706;
      --info: #3b82f6;
      --info-dark: #2563eb;
      --light: #f3f4f6;
      --light-hover: #e5e7eb;
      --dark: #1f2937;
      --dark-bg: #111827;
      --white: #ffffff;
      --gray-100: #f9fafb;
      --gray-200: #e5e7eb;
      --gray-300: #d1d5db;
      --gray-400: #9ca3af;
      --gray-500: #6b7280;
      --gray-600: #4b5563;
      --gray-700: #374151;
      --gray-800: #1f2937;
      --gray-900: #111827;
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      --shadow-md: 0 6px 12px -2px rgba(0, 0, 0, 0.15);
      --shadow-lg: 0 10px 25px -3px rgba(0, 0, 0, 0.2);
      --shadow-xl: 0 20px 40px -5px rgba(0, 0, 0, 0.25);
      --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --gradient-success: linear-gradient(135deg, #10b981 0%, #059669 100%);
      --gradient-danger: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      --gradient-warning: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      --gradient-info: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
      --gradient-hero: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      --border-radius: 12px;
      --border-radius-lg: 16px;
      --border-radius-xl: 20px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      transition: var(--transition);
      position: relative;
      overflow-x: hidden;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 50%, rgba(99, 102, 241, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(139, 92, 246, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 40% 20%, rgba(240, 147, 251, 0.1) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
      animation: gradientShift 15s ease infinite;
    }

    @keyframes gradientShift {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }

    body.dark-mode {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    }

    body.dark-mode::before {
      background: 
        radial-gradient(circle at 20% 50%, rgba(99, 102, 241, 0.08) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(139, 92, 246, 0.08) 0%, transparent 50%);
    }

    .container {
      max-width: 1600px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.98);
      border-radius: var(--border-radius-xl);
      box-shadow: var(--shadow-xl);
      overflow: hidden;
      position: relative;
      z-index: 1;
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    body.dark-mode .container {
      background: rgba(31, 41, 55, 0.98);
      color: var(--white);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .header {
      background: var(--gradient-hero);
      color: white;
      padding: 40px 45px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 25px;
      position: relative;
      overflow: hidden;
    }

    .header::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -10%;
      width: 500px;
      height: 500px;
      background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);
      border-radius: 50%;
      animation: float 8s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translate(0, 0); }
      50% { transform: translate(-30px, -30px); }
    }

    .header::after {
      content: '';
      position: absolute;
      bottom: -30%;
      left: -5%;
      width: 350px;
      height: 350px;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
      border-radius: 50%;
      animation: float 10s ease-in-out infinite reverse;
    }

    .header h1 {
      font-size: 2.5em;
      font-weight: 900;
      display: flex;
      align-items: center;
      gap: 20px;
      position: relative;
      z-index: 1;
      letter-spacing: -1px;
      text-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .header h1 i {
      font-size: 1.2em;
      filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
      animation: glow 2s ease-in-out infinite;
    }

    @keyframes glow {
      0%, 100% { filter: drop-shadow(0 4px 8px rgba(255,255,255,0.3)); }
      50% { filter: drop-shadow(0 4px 16px rgba(255,255,255,0.6)); }
    }

    .header h1 .version {
      font-size: 0.35em;
      opacity: 0.9;
      font-weight: 700;
      background: rgba(255,255,255,0.25);
      padding: 8px 16px;
      border-radius: 25px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.3);
    }

    .header-actions {
      display: flex;
      gap: 15px;
      align-items: center;
      position: relative;
      z-index: 1;
      flex-wrap: wrap;
    }

    .btn {
      padding: 13px 26px;
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      font-size: 1em;
      font-weight: 600;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      gap: 10px;
      text-decoration: none;
      position: relative;
      overflow: hidden;
      font-family: 'Inter', sans-serif;
      box-shadow: var(--shadow-md);
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255,255,255,0.3);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    .btn:hover::before {
      width: 300px;
      height: 300px;
    }

    .btn:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-lg);
    }

    .btn:active {
      transform: translateY(-1px);
    }

    .btn > * {
      position: relative;
      z-index: 1;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
    }

    .btn-success {
      background: linear-gradient(135deg, var(--success) 0%, var(--success-dark) 100%);
      color: white;
    }

    .btn-danger {
      background: linear-gradient(135deg, var(--danger) 0%, var(--danger-dark) 100%);
      color: white;
    }

    .btn-warning {
      background: linear-gradient(135deg, var(--warning) 0%, var(--warning-dark) 100%);
      color: white;
    }

    .btn-info {
      background: linear-gradient(135deg, var(--info) 0%, var(--info-dark) 100%);
      color: white;
    }

    .btn-secondary {
      background: linear-gradient(135deg, var(--gray-600) 0%, var(--gray-700) 100%);
      color: white;
    }

    .btn-sm {
      padding: 9px 18px;
      font-size: 0.9em;
    }

    .btn-lg {
      padding: 16px 32px;
      font-size: 1.1em;
    }

    .btn-ics {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
      animation: pulse-ics 2s ease-in-out infinite;
    }

    @keyframes pulse-ics {
      0%, 100% { box-shadow: 0 0 0 0 rgba(240, 147, 251, 0.7); }
      50% { box-shadow: 0 0 0 15px rgba(240, 147, 251, 0); }
    }

    .tabs {
      display: flex;
      background: linear-gradient(to right, var(--gray-100), var(--gray-50));
      padding: 0;
      overflow-x: auto;
      border-bottom: 3px solid var(--primary);
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    body.dark-mode .tabs {
      background: linear-gradient(to right, rgba(45, 55, 72, 0.98), rgba(55, 65, 81, 0.98));
      border-bottom-color: var(--primary-light);
    }

    .tab {
      padding: 22px 32px;
      cursor: pointer;
      border: none;
      background: transparent;
      font-size: 1em;
      font-weight: 600;
      color: var(--gray-600);
      transition: var(--transition);
      white-space: nowrap;
      display: flex;
      align-items: center;
      gap: 12px;
      position: relative;
      font-family: 'Inter', sans-serif;
    }

    .tab::after {
      content: '';
      position: absolute;
      bottom: -3px;
      left: 0;
      width: 0;
      height: 3px;
      background: linear-gradient(to right, var(--primary), var(--secondary));
      transition: width 0.3s ease;
    }

    body.dark-mode .tab {
      color: var(--gray-300);
    }

    .tab:hover {
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
      color: var(--primary);
      transform: translateY(-2px);
    }

    .tab.active {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
    }

    .tab.active::after {
      width: 100%;
    }

    .tab i {
      font-size: 1.1em;
    }

    .tab-content {
      display: none;
      padding: 40px;
      animation: fadeInUp 0.5s ease;
    }

    .tab-content.active {
      display: block;
    }

    @keyframes fadeInUp {
      from { 
        opacity: 0; 
        transform: translateY(20px); 
      }
      to { 
        opacity: 1; 
        transform: translateY(0); 
      }
    }

    .upcoming-hearings-widget {
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.05), rgba(139, 92, 246, 0.05));
      border: 2px solid var(--primary);
      border-radius: var(--border-radius-lg);
      padding: 30px;
      margin-bottom: 35px;
      box-shadow: var(--shadow-lg);
      position: relative;
      overflow: hidden;
    }

    .upcoming-hearings-widget::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -20%;
      width: 300px;
      height: 300px;
      background: radial-gradient(circle, rgba(99, 102, 241, 0.1), transparent);
      border-radius: 50%;
    }

    .upcoming-hearings-widget h3 {
      font-size: 1.6em;
      font-weight: 800;
      margin-bottom: 25px;
      display: flex;
      align-items: center;
      gap: 15px;
      color: var(--primary);
      position: relative;
      z-index: 1;
    }

    .upcoming-hearings-widget h3 i {
      font-size: 1.2em;
      animation: ring 2s ease-in-out infinite;
    }

    @keyframes ring {
      0%, 100% { transform: rotate(0deg); }
      10%, 30% { transform: rotate(-10deg); }
      20%, 40% { transform: rotate(10deg); }
    }

    .hearing-item {
      background: white;
      padding: 20px;
      border-radius: var(--border-radius);
      margin-bottom: 15px;
      box-shadow: var(--shadow-md);
      transition: var(--transition);
      border-left: 5px solid var(--info);
      position: relative;
      z-index: 1;
    }

    body.dark-mode .hearing-item {
      background: var(--gray-700);
    }

    .hearing-item:hover {
      transform: translateX(5px);
      box-shadow: var(--shadow-lg);
    }

    .hearing-item.urgent-24h {
      border-left-color: var(--danger);
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.08), white);
      animation: urgentPulse 2s ease-in-out infinite;
    }

    body.dark-mode .hearing-item.urgent-24h {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), var(--gray-700));
    }

    @keyframes urgentPulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
      50% { box-shadow: 0 0 0 15px rgba(239, 68, 68, 0); }
    }

    .hearing-item-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 12px;
    }

    .hearing-item-title {
      font-size: 1.1em;
      font-weight: 700;
      color: var(--gray-900);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    body.dark-mode .hearing-item-title {
      color: white;
    }

    .hearing-item-time {
      font-size: 1.2em;
      font-weight: 800;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .hearing-item.urgent-24h .hearing-item-time {
      color: var(--danger);
      animation: blink 1.5s ease-in-out infinite;
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    .hearing-item-details {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      color: var(--gray-600);
      font-size: 0.95em;
    }

    body.dark-mode .hearing-item-details {
      color: var(--gray-300);
    }

    .hearing-item-detail {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .hearing-item-detail i {
      color: var(--primary);
      width: 20px;
    }

    .hearing-item.urgent-24h .hearing-item-detail i {
      color: var(--danger);
    }

    .countdown-badge {
      background: linear-gradient(135deg, var(--danger), var(--danger-dark));
      color: white;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.85em;
      font-weight: 700;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 25px;
      margin-bottom: 35px;
    }

    .stat-card {
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
      padding: 35px;
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-lg);
      transition: var(--transition);
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.2);
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -20%;
      width: 200px;
      height: 200px;
      background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 70%);
      border-radius: 50%;
      animation: float 6s ease-in-out infinite;
    }

    .stat-card:hover {
      transform: translateY(-10px) scale(1.03);
      box-shadow: var(--shadow-xl);
    }

    .stat-card h3 {
      font-size: 3.2em;
      margin-bottom: 15px;
      font-weight: 900;
      position: relative;
      z-index: 1;
      text-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    .stat-card p {
      font-size: 1.15em;
      opacity: 0.95;
      font-weight: 600;
      position: relative;
      z-index: 1;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .stat-card p i {
      font-size: 1.4em;
    }

    .form-group {
      margin-bottom: 22px;
    }

    .form-group label {
      display: block;
      margin-bottom: 10px;
      font-weight: 600;
      color: var(--gray-700);
      font-size: 0.95em;
      letter-spacing: 0.3px;
    }

    body.dark-mode .form-group label {
      color: var(--gray-300);
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 14px 18px;
      border: 2px solid var(--gray-200);
      border-radius: var(--border-radius);
      font-size: 1em;
      transition: var(--transition);
      font-family: 'Inter', sans-serif;
      background: white;
    }

    body.dark-mode .form-group input,
    body.dark-mode .form-group select,
    body.dark-mode .form-group textarea {
      background: var(--gray-700);
      border-color: var(--gray-600);
      color: white;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
      transform: translateY(-2px);
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }

    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      margin-top: 25px;
      background: var(--white);
      border-radius: var(--border-radius-lg);
      overflow: hidden;
      box-shadow: var(--shadow-md);
    }

    body.dark-mode table {
      background: var(--gray-800);
    }

    thead {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
    }

    th {
      padding: 18px 20px;
      text-align: left;
      font-weight: 700;
      font-size: 0.95em;
      letter-spacing: 0.5px;
      text-transform: uppercase;
    }

    td {
      padding: 18px 20px;
      text-align: left;
      border-bottom: 1px solid var(--gray-200);
      font-size: 0.95em;
    }

    body.dark-mode td {
      border-bottom-color: var(--gray-700);
    }

    tbody tr {
      transition: var(--transition);
    }

    tbody tr:hover {
      background: rgba(99, 102, 241, 0.05);
      transform: scale(1.01);
    }

    body.dark-mode tbody tr:hover {
      background: rgba(99, 102, 241, 0.1);
    }

    tbody tr:last-child td {
      border-bottom: none;
    }

    .badge {
      padding: 7px 14px;
      border-radius: 20px;
      font-size: 0.85em;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      letter-spacing: 0.3px;
    }

    .badge-success { 
      background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); 
      color: #065f46; 
    }
    .badge-warning { 
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); 
      color: #92400e; 
    }
    .badge-danger { 
      background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); 
      color: #991b1b; 
    }
    .badge-info { 
      background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); 
      color: #1e40af; 
    }
    .badge-secondary { 
      background: linear-gradient(135deg, #e5e7eb 0%, #d1d5db 100%); 
      color: #374151; 
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.75);
      z-index: 2000;
      animation: fadeIn 0.3s ease;
      backdrop-filter: blur(8px);
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal-content {
      background: white;
      max-width: 800px;
      margin: 40px auto;
      padding: 40px;
      border-radius: var(--border-radius-xl);
      box-shadow: var(--shadow-xl);
      max-height: 90vh;
      overflow-y: auto;
      animation: slideDown 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
    }

    body.dark-mode .modal-content {
      background: var(--gray-800);
      color: white;
    }

    @keyframes slideDown {
      from { 
        transform: translateY(-60px) scale(0.95); 
        opacity: 0; 
      }
      to { 
        transform: translateY(0) scale(1); 
        opacity: 1; 
      }
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid var(--gray-200);
    }

    body.dark-mode .modal-header {
      border-bottom-color: var(--gray-700);
    }

    .modal-header h2 {
      font-size: 1.8em;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .close {
      font-size: 2.2em;
      cursor: pointer;
      color: var(--gray-400);
      transition: var(--transition);
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      background: var(--gray-100);
    }

    body.dark-mode .close {
      background: var(--gray-700);
    }

    .close:hover {
      color: white;
      background: var(--danger);
      transform: rotate(90deg) scale(1.1);
    }

    .notification {
      position: fixed;
      top: 25px;
      right: 25px;
      padding: 20px 30px;
      background: white;
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-xl);
      z-index: 3000;
      animation: slideInRight 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      max-width: 450px;
      display: flex;
      align-items: center;
      gap: 15px;
      border-left: 5px solid var(--primary);
    }

    @keyframes slideInRight {
      from { 
        transform: translateX(500px); 
        opacity: 0; 
      }
      to { 
        transform: translateX(0); 
        opacity: 1; 
      }
    }

    .notification.success { 
      border-left-color: var(--success); 
      background: linear-gradient(135deg, #d1fae5 0%, white 100%);
    }
    .notification.danger { 
      border-left-color: var(--danger); 
      background: linear-gradient(135deg, #fee2e2 0%, white 100%);
    }
    .notification.warning { 
      border-left-color: var(--warning); 
      background: linear-gradient(135deg, #fef3c7 0%, white 100%);
    }
    .notification.info { 
      border-left-color: var(--info); 
      background: linear-gradient(135deg, #dbeafe 0%, white 100%);
    }

    .reminder-alert {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.92);
      z-index: 5000;
      display: none;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(15px);
    }

    .reminder-alert.active {
      display: flex;
    }

    .reminder-alert-content {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 60px;
      border-radius: var(--border-radius-xl);
      max-width: 700px;
      text-align: center;
      animation: bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      box-shadow: 0 25px 50px rgba(0,0,0,0.5);
      position: relative;
      overflow: hidden;
    }

    @keyframes bounceIn {
      0% { 
        transform: scale(0.3); 
        opacity: 0; 
      }
      50% { 
        transform: scale(1.05); 
      }
      70% { 
        transform: scale(0.9); 
      }
      100% { 
        transform: scale(1); 
        opacity: 1; 
      }
    }

    .reminder-alert-icon {
      font-size: 6em;
      margin-bottom: 25px;
      animation: bellRing 1s ease-in-out infinite;
    }

    @keyframes bellRing {
      0%, 100% { transform: rotate(0deg); }
      10%, 30%, 50%, 70%, 90% { transform: rotate(-15deg); }
      20%, 40%, 60%, 80% { transform: rotate(15deg); }
    }

    .reminder-alert-title {
      font-size: 2.5em;
      font-weight: 900;
      margin-bottom: 20px;
    }

    .reminder-alert-message {
      font-size: 1.4em;
      margin-bottom: 35px;
      line-height: 1.6;
    }

    #abdullahBtn {
      position: fixed;
      bottom: 35px;
      right: 35px;
      width: 75px;
      height: 75px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
      border: none;
      font-size: 2.2em;
      cursor: pointer;
      box-shadow: var(--shadow-xl);
      z-index: 999;
      transition: var(--transition);
      animation: pulse 2s infinite;
    }

    #abdullahBtn:hover {
      transform: scale(1.15);
    }

    #abdullahBtn.active {
      background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
    }

    #abdullahChat {
      position: fixed;
      bottom: 130px;
      right: 35px;
      width: 450px;
      max-height: 650px;
      background: white;
      border-radius: var(--border-radius-xl);
      box-shadow: var(--shadow-xl);
      z-index: 998;
      display: none;
      flex-direction: column;
      overflow: hidden;
    }

    body.dark-mode #abdullahChat {
      background: var(--gray-800);
    }

    #abdullahChat.active {
      display: flex;
      animation: slideUp 0.4s;
    }

    @keyframes slideUp {
      from { 
        transform: translateY(60px) scale(0.9); 
        opacity: 0; 
      }
      to { 
        transform: translateY(0) scale(1); 
        opacity: 1; 
      }
    }

    .abdullah-header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
      padding: 25px;
      font-weight: 700;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .abdullah-body {
      flex: 1;
      padding: 25px;
      overflow-y: auto;
      max-height: 450px;
      background: var(--gray-50);
    }

    body.dark-mode .abdullah-body {
      background: var(--gray-900);
    }

    .abdullah-message {
      margin-bottom: 18px;
      padding: 14px 20px;
      border-radius: var(--border-radius);
      max-width: 85%;
      line-height: 1.6;
    }

    .abdullah-message.user {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: white;
      margin-left: auto;
      text-align: right;
    }

    .abdullah-message.assistant {
      background: white;
      color: var(--gray-900);
      border: 1px solid var(--gray-200);
    }

    body.dark-mode .abdullah-message.assistant {
      background: var(--gray-700);
      color: white;
    }

    .abdullah-input {
      display: flex;
      padding: 20px;
      border-top: 2px solid var(--gray-200);
      gap: 12px;
    }

    body.dark-mode .abdullah-input {
      border-top-color: var(--gray-700);
    }

    .abdullah-input input {
      flex: 1;
      padding: 13px 18px;
      border: 2px solid var(--gray-200);
      border-radius: var(--border-radius);
      font-size: 1em;
    }

    body.dark-mode .abdullah-input input {
      background: var(--gray-700);
      border-color: var(--gray-600);
      color: white;
    }

    .priority-high { border-left: 5px solid var(--danger); }
    .priority-medium { border-left: 5px solid var(--warning); }
    .priority-low { border-left: 5px solid var(--info); }

    .payment-status {
      padding: 9px 18px;
      border-radius: 20px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .payment-paid { 
      background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); 
      color: #065f46; 
    }
    .payment-pending { 
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); 
      color: #92400e; 
    }

    .filter-buttons {
      display: flex;
      gap: 12px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }

    .chart-container {
      background: white;
      padding: 30px;
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-md);
      margin-bottom: 25px;
    }

    body.dark-mode .chart-container {
      background: var(--gray-800);
    }

    .chart-container h3 {
      margin-bottom: 25px;
      font-size: 1.4em;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .case-detail-card, .reminder-card, .document-card {
      background: white;
      padding: 30px;
      border-radius: var(--border-radius-lg);
      box-shadow: var(--shadow-md);
      margin-bottom: 25px;
      transition: var(--transition);
    }

    body.dark-mode .case-detail-card,
    body.dark-mode .reminder-card,
    body.dark-mode .document-card {
      background: var(--gray-800);
    }

    .case-detail-card:hover,
    .reminder-card:hover,
    .document-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-xl);
    }

    .reminder-card.urgent {
      border: 3px solid var(--danger);
      animation: pulse 2s infinite;
    }

    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }

    .info-item {
      background: var(--gray-50);
      padding: 18px;
      border-radius: var(--border-radius);
      border-left: 4px solid var(--primary);
    }

    body.dark-mode .info-item {
      background: var(--gray-700);
    }

    .info-item label {
      font-size: 0.85em;
      color: var(--gray-500);
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      text-transform: uppercase;
    }

    .info-item .value {
      font-size: 1.1em;
      font-weight: 600;
      color: var(--gray-900);
    }

    body.dark-mode .info-item .value {
      color: white;
    }

    @media (max-width: 768px) {
      .header h1 { font-size: 1.6em; }
      .dashboard-grid { grid-template-columns: 1fr; }
      #abdullahChat { width: 90%; right: 5%; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- HEADER -->
    <div class="header">
      <h1>
        <i class="fas fa-gavel"></i>
        Dava Yönetim Sistemi Pro
        <span class="version">v4.5 Ultra</span>
      </h1>
      <div class="header-actions">
        <button class="btn btn-ics" onclick="document.getElementById('icsFileInput').click()">
          <i class="fas fa-calendar-plus"></i> UYAP ICS Yükle
        </button>
        <input type="file" id="icsFileInput" accept=".ics" style="display: none;" onchange="uploadICSFile(event)">
        <button class="btn btn-warning" onclick="startVoiceSearch()">
          <i class="fas fa-microphone"></i> Sesli Arama
        </button>
        <button class="btn btn-info" onclick="toggleTheme()" id="themeBtn">
          <i class="fas fa-moon" id="themeIcon"></i>
        </button>
      </div>
    </div>

    <!-- TABS -->
    <div class="tabs">
      <button class="tab active" onclick="switchTab('dashboard')">
        <i class="fas fa-chart-line"></i> Dashboard
      </button>
      <button class="tab" onclick="switchTab('cases')">
        <i class="fas fa-folder-open"></i> Davalar
      </button>
      <button class="tab" onclick="switchTab('hearings')">
        <i class="fas fa-calendar-alt"></i> Duruşmalar
      </button>
      <button class="tab" onclick="switchTab('payments')">
        <i class="fas fa-money-bill-wave"></i> Ücretler
      </button>
      <button class="tab" onclick="switchTab('reminders')">
        <i class="fas fa-bell"></i> Hatırlatıcılar
      </button>
      <button class="tab" onclick="switchTab('documents')">
        <i class="fas fa-file-alt"></i> Belgeler
      </button>
      <button class="tab" onclick="switchTab('calendar')">
        <i class="fas fa-calendar"></i> Takvim
      </button>
      <button class="tab" onclick="switchTab('reports')">
        <i class="fas fa-chart-bar"></i> Raporlar
      </button>
      <button class="tab" onclick="switchTab('settings')">
        <i class="fas fa-cog"></i> Ayarlar
      </button>
    </div>

    <!-- DASHBOARD TAB -->
    <div id="dashboard" class="tab-content active">
      <h2 style="margin-bottom: 30px; font-size: 2em; font-weight: 800;">
        <i class="fas fa-chart-line"></i> Genel Bakış
      </h2>

      <!-- YAKLAŞAN DURUŞMALAR WİDGET -->
      <div class="upcoming-hearings-widget" id="upcomingHearingsWidget">
        <h3>
          <i class="fas fa-bell"></i>
          Yaklaşan Duruşmalar
          <span class="badge badge-danger" id="urgentHearingsCount" style="margin-left: 10px;">0</span>
        </h3>
        <div id="upcomingHearingsList"></div>
      </div>
      
      <div class="dashboard-grid">
        <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
          <h3 id="totalCases">0</h3>
          <p><i class="fas fa-folder-open"></i> Toplam Dava</p>
        </div>
        <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
          <h3 id="activeCases">0</h3>
          <p><i class="fas fa-fire"></i> Aktif Dava</p>
        </div>
        <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
          <h3 id="upcomingHearings">0</h3>
          <p><i class="fas fa-calendar-check"></i> Yaklaşan Duruşma</p>
        </div>
        <div class="stat-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
          <h3 id="totalVekaletUcreti">0 ₺</h3>
          <p><i class="fas fa-coins"></i> Toplam Vekalet Ücreti</p>
        </div>
        <div class="stat-card" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
          <h3 id="tahsilEdilen">0 ₺</h3>
          <p><i class="fas fa-check-circle"></i> Tahsil Edilen</p>
        </div>
        <div class="stat-card" style="background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);">
          <h3 id="tahsilBekleyen">0 ₺</h3>
          <p><i class="fas fa-hourglass-half"></i> Tahsil Bekleyen</p>
        </div>
      </div>

      <div class="chart-container">
        <h3><i class="fas fa-chart-pie"></i> Dava Durumu Dağılımı</h3>
        <canvas id="caseStatusChart" height="100"></canvas>
      </div>

      <div class="chart-container">
        <h3><i class="fas fa-chart-bar"></i> Aylık Duruşma Takvimi</h3>
        <canvas id="hearingChart" height="100"></canvas>
      </div>

      <div class="chart-container">
        <h3><i class="fas fa-chart-line"></i> Vekalet Ücreti İstatistikleri</h3>
        <canvas id="vekaletChart" height="100"></canvas>
      </div>
    </div>

    <!-- CASES TAB -->
    <div id="cases" class="tab-content">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; flex-wrap: wrap; gap: 15px;">
        <h2 style="font-size: 2em; font-weight: 800;">
          <i class="fas fa-folder-open"></i> Dava Yönetimi
        </h2>
        <div style="display: flex; gap: 10px;">
          <button class="btn btn-success" onclick="openModal('addCaseModal')">
            <i class="fas fa-plus"></i> Yeni Dava Ekle
          </button>
          <button class="btn btn-info" onclick="exportToExcel()">
            <i class="fas fa-file-excel"></i> Excel'e Aktar
          </button>
        </div>
      </div>

      <!-- GELİŞMİŞ ARAMA -->
      <div style="background: white; padding: 25px; border-radius: var(--border-radius-lg); box-shadow: var(--shadow-md); margin-bottom: 25px;">
        <h3 style="margin-bottom: 20px; font-weight: 700; display: flex; align-items: center; gap: 10px;">
          <i class="fas fa-search"></i> Gelişmiş Arama
        </h3>
        <div class="form-grid">
          <div class="form-group">
            <label>Esas No</label>
            <input type="text" id="searchEsasNo" placeholder="2024/123" onkeyup="advancedSearch()">
          </div>
          <div class="form-group">
            <label>Taraf Adı</label>
            <input type="text" id="searchTarafAd" placeholder="Ahmet" onkeyup="advancedSearch()">
          </div>
          <div class="form-group">
            <label>Taraf Soyadı</label>
            <input type="text" id="searchTarafSoyad" placeholder="Yılmaz" onkeyup="advancedSearch()">
          </div>
          <div class="form-group">
            <label>TC Kimlik No</label>
            <input type="text" id="searchTC" placeholder="12345678901" onkeyup="advancedSearch()">
          </div>
          <div class="form-group">
            <label>Avukat TC</label>
            <input type="text" id="searchAvukatTC" placeholder="Avukat TC" onkeyup="advancedSearch()">
          </div>
          <div class="form-group">
            <label>Mahkeme Türü</label>
            <select id="searchMahkeme" onchange="advancedSearch()">
              <option value="">Tümü</option>
              <option value="Asliye Hukuk">Asliye Hukuk</option>
              <option value="Asliye Ceza">Asliye Ceza</option>
              <option value="Ağır Ceza">Ağır Ceza</option>
              <option value="İcra">İcra</option>
              <option value="Aile">Aile</option>
              <option value="İş">İş</option>
              <option value="Ticaret">Ticaret</option>
              <option value="İdare">İdare</option>
            </select>
          </div>
        </div>
        <button class="btn btn-secondary" onclick="clearSearch()" style="margin-top: 15px;">
          <i class="fas fa-times"></i> Aramayı Temizle
        </button>
      </div>

      <div class="filter-buttons">
        <button class="btn btn-sm btn-primary" onclick="filterCases('all')">
          <i class="fas fa-list"></i> Tümü
        </button>
        <button class="btn btn-sm btn-success" onclick="filterCases('Aktif')">
          <i class="fas fa-fire"></i> Aktif
        </button>
        <button class="btn btn-sm btn-warning" onclick="filterCases('Beklemede')">
          <i class="fas fa-pause"></i> Beklemede
        </button>
        <button class="btn btn-sm btn-secondary" onclick="filterCases('Kapalı')">
          <i class="fas fa-lock"></i> Kapalı
        </button>
        <button class="btn btn-sm btn-danger" onclick="filterCases('favorites')">
          <i class="fas fa-star"></i> Favoriler
        </button>
      </div>

      <div id="casesList"></div>
    </div>

    <!-- HEARINGS TAB -->
    <div id="hearings" class="tab-content">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; flex-wrap: wrap; gap: 15px;">
        <h2 style="font-size: 2em; font-weight: 800;">
          <i class="fas fa-calendar-alt"></i> Duruşma Takvimi
        </h2>
        <div style="display: flex; gap: 10px;">
          <button class="btn btn-ics" onclick="document.getElementById('icsFileInput2').click()">
            <i class="fas fa-calendar-plus"></i> UYAP ICS Yükle
          </button>
          <input type="file" id="icsFileInput2" accept=".ics" style="display: none;" onchange="uploadICSFile(event)">
          <button class="btn btn-success" onclick="openModal('addHearingModal')">
            <i class="fas fa-plus"></i> Yeni Duruşma Ekle
          </button>
        </div>
      </div>
      <div id="hearingsList"></div>
    </div>

    <!-- PAYMENTS TAB -->
    <div id="payments" class="tab-content">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; flex-wrap: wrap; gap: 15px;">
        <h2 style="font-size: 2em; font-weight: 800;">
          <i class="fas fa-money-bill-wave"></i> Ücret Takibi
        </h2>
        <button class="btn btn-success" onclick="openModal('addPaymentModal')">
          <i class="fas fa-plus"></i> Yeni Ödeme Ekle
        </button>
      </div>

      <div class="dashboard-grid" style="margin-bottom: 30px;">
        <div class="stat-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
          <h3 id="totalPaidDetail">0 ₺</h3>
          <p><i class="fas fa-check-circle"></i> Tahsil Edilen Toplam</p>
        </div>
        <div class="stat-card" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
          <h3 id="totalPendingDetail">0 ₺</h3>
          <p><i class="fas fa-clock"></i> Bekleyen Toplam</p>
        </div>
        <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
          <h3 id="vekaletUcretiPaid">0 ₺</h3>
          <p><i class="fas fa-coins"></i> Tahsil Edilen Vekalet</p>
        </div>
        <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
          <h3 id="vekaletUcretiPending">0 ₺</h3>
          <p><i class="fas fa-hourglass-half"></i> Bekleyen Vekalet</p>
        </div>
      </div>

      <div id="paymentsList"></div>
    </div>

    <!-- REMINDERS TAB -->
    <div id="reminders" class="tab-content">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; flex-wrap: wrap; gap: 15px;">
        <h2 style="font-size: 2em; font-weight: 800;">
          <i class="fas fa-bell"></i> Hatırlatıcılar
        </h2>
        <button class="btn btn-success" onclick="openModal('addReminderModal')">
          <i class="fas fa-plus"></i> Yeni Hatırlatıcı Ekle
        </button>
      </div>
      <div id="remindersList"></div>
    </div>

    <!-- DOCUMENTS TAB -->
    <div id="documents" class="tab-content">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; flex-wrap: wrap; gap: 15px;">
        <h2 style="font-size: 2em; font-weight: 800;">
          <i class="fas fa-file-alt"></i> Belge Yönetimi
        </h2>
      </div>

      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
        <div class="case-detail-card">
          <h3 style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
            <i class="fas fa-upload"></i> Belge Yükle
          </h3>
          <input type="file" id="fileUpload" multiple accept=".pdf,.docx,.jpg,.jpeg,.png" style="margin-bottom: 15px;">
          <button class="btn btn-primary" onclick="uploadDocuments()">
            <i class="fas fa-cloud-upload-alt"></i> Yükle
          </button>
        </div>

        <div class="case-detail-card">
          <h3 style="margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
            <i class="fas fa-camera"></i> OCR ile Yükle
          </h3>
          <input type="file" id="ocrFileUpload" accept="image/*" style="margin-bottom: 15px;">
          <button class="btn btn-info" onclick="uploadWithOCR()">
            <i class="fas fa-text-height"></i> OCR İşle
          </button>
        </div>
      </div>

      <div id="documentsList"></div>
    </div>

    <!-- CALENDAR TAB -->
    <div id="calendar" class="tab-content">
      <h2 style="margin-bottom: 30px; font-size: 2em; font-weight: 800;">
        <i class="fas fa-calendar"></i> Duruşma Takvimi
      </h2>
      <div id="calendarView"></div>
    </div>

    <!-- REPORTS TAB -->
    <div id="reports" class="tab-content">
      <h2 style="margin-bottom: 30px; font-size: 2em; font-weight: 800;">
        <i class="fas fa-chart-bar"></i> Raporlar
      </h2>
      
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
        <div class="case-detail-card" style="text-align: center;">
          <i class="fas fa-file-excel" style="font-size: 4em; color: var(--success); margin-bottom: 20px;"></i>
          <h3 style="margin-bottom: 15px;">Excel Raporu</h3>
          <p style="color: #666; margin-bottom: 20px;">Tüm davaları Excel formatında indirin</p>
          <button class="btn btn-success" onclick="exportToExcel()">
            <i class="fas fa-download"></i> İndir
          </button>
        </div>

        <div class="case-detail-card" style="text-align: center;">
          <i class="fas fa-file-pdf" style="font-size: 4em; color: var(--danger); margin-bottom: 20px;"></i>
          <h3 style="margin-bottom: 15px;">Genel Rapor</h3>
          <p style="color: #666; margin-bottom: 20px;">Tüm davaların PDF raporu</p>
          <button class="btn btn-danger" onclick="generateFullReport()">
            <i class="fas fa-download"></i> İndir
          </button>
        </div>

        <div class="case-detail-card" style="text-align: center;">
          <i class="fas fa-calendar-alt" style="font-size: 4em; color: var(--info); margin-bottom: 20px;"></i>
          <h3 style="margin-bottom: 15px;">Duruşma Raporu</h3>
          <p style="color: #666; margin-bottom: 20px;">Duruşma takvimi PDF raporu</p>
          <button class="btn btn-info" onclick="generateHearingReport()">
            <i class="fas fa-download"></i> İndir
          </button>
        </div>

        <div class="case-detail-card" style="text-align: center;">
          <i class="fas fa-money-bill-wave" style="font-size: 4em; color: var(--warning); margin-bottom: 20px;"></i>
          <h3 style="margin-bottom: 15px;">Ücret Raporu</h3>
          <p style="color: #666; margin-bottom: 20px;">Ödeme takip PDF raporu</p>
          <button class="btn btn-warning" onclick="generatePaymentReport()">
            <i class="fas fa-download"></i> İndir
          </button>
        </div>
      </div>
    </div>

    <!-- SETTINGS TAB -->
    <div id="settings" class="tab-content">
      <h2 style="margin-bottom: 30px; font-size: 2em; font-weight: 800;">
        <i class="fas fa-cog"></i> Ayarlar
      </h2>

      <div class="case-detail-card" style="margin-bottom: 30px;">
        <h3 style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
          <i class="fas fa-robot"></i> Abdullah AI Ayarları
        </h3>
        
        <div class="form-group">
          <label>Google Gemini API Anahtarı</label>
          <input type="password" id="geminiApiKey" placeholder="AIzaSy...">
          <small style="color: #666; display: block; margin-top: 5px;">
            API anahtarı almak için: <a href="https://aistudio.google.com/app/apikey" target="_blank">https://aistudio.google.com/app/apikey</a>
          </small>
        </div>

        <div class="form-group">
          <label>AI Modeli</label>
          <select id="aiModel">
            <option value="gemini-2.5-flash">Gemini 2.5 Flash (Önerilen)</option>
            <option value="gemini-2.5-pro">Gemini 2.5 Pro</option>
            <option value="gemini-1.5-flash">Gemini 1.5 Flash</option>
          </select>
        </div>

        <div style="display: flex; gap: 10px;">
          <button class="btn btn-success" onclick="saveAISettings()">
            <i class="fas fa-save"></i> Kaydet
          </button>
          <button class="btn btn-info" onclick="testAIConnection()">
            <i class="fas fa-plug"></i> Bağlantıyı Test Et
          </button>
        </div>
      </div>

      <div class="case-detail-card" style="margin-bottom: 30px;">
        <h3 style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
          <i class="fas fa-database"></i> Veri Yönetimi
        </h3>
        
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
          <button class="btn btn-primary" onclick="backupData()">
            <i class="fas fa-download"></i> Yedek Al
          </button>
          <button class="btn btn-warning" onclick="document.getElementById('backupFile').click()">
            <i class="fas fa-upload"></i> Yedek Yükle
          </button>
          <input type="file" id="backupFile" accept=".json" style="display: none;" onchange="restoreData()">
          <button class="btn btn-danger" onclick="clearAllData()">
            <i class="fas fa-trash"></i> Tüm Verileri Sil
          </button>
        </div>
      </div>

      <div class="case-detail-card">
        <h3 style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
          <i class="fas fa-info-circle"></i> Hakkında
        </h3>
        <p><strong>Versiyon:</strong> 4.5 Ultra Edition</p>
        <p><strong>Özellikler:</strong> Abdullah AI, ICS Yükleme, Gelişmiş Arama, Vekalet Ücreti Takibi, OCR, Renkli/Sesli Hatırlatıcılar</p>
        <p><strong>Son Güncelleme:</strong> 2025</p>
      </div>
    </div>
  </div>

  <!-- ADD CASE MODAL -->
  <div id="addCaseModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2><i class="fas fa-plus"></i> Yeni Dava Ekle</h2>
        <span class="close" onclick="closeModal('addCaseModal')">&times;</span>
      </div>
      <form onsubmit="addCase(event)">
        <h3 style="margin-bottom: 20px; color: var(--primary);">
          <i class="fas fa-gavel"></i> Dava Bilgileri
        </h3>
        
        <div class="form-grid">
          <div class="form-group">
            <label>Esas No *</label>
            <input type="text" id="esasNo" required placeholder="2024/123">
          </div>
          <div class="form-group">
            <label>Mahkeme Türü *</label>
            <select id="mahkemeTuru" required>
              <option value="">Seçiniz</option>
              <option value="Asliye Hukuk">Asliye Hukuk</option>
              <option value="Asliye Ceza">Asliye Ceza</option>
              <option value="Ağır Ceza">Ağır Ceza</option>
              <option value="İcra">İcra</option>
              <option value="Aile">Aile</option>
              <option value="İş">İş</option>
              <option value="Ticaret">Ticaret</option>
              <option value="İdare">İdare</option>
            </select>
          </div>
        </div>

        <h3 style="margin: 30px 0 20px; color: var(--primary);">
          <i class="fas fa-user"></i> Taraf Bilgileri
        </h3>

        <div class="form-grid">
          <div class="form-group">
            <label>Taraf Adı *</label>
            <input type="text" id="tarafAd" required>
          </div>
          <div class="form-group">
            <label>Taraf Soyadı *</label>
            <input type="text" id="tarafSoyad" required>
          </div>
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label>TC Kimlik No *</label>
            <input type="text" id="tarafTC" required pattern="[0-9]{11}" placeholder="12345678901" maxlength="11">
          </div>
          <div class="form-group">
            <label>Telefon</label>
            <input type="tel" id="tarafTelefon" placeholder="0555 123 4567">
          </div>
        </div>

        <div class="form-group">
          <label>E-posta</label>
          <input type="email" id="tarafEmail" placeholder="ornek@email.com">
          </div>

        <div class="form-group">
          <label>Adres</label>
          <textarea id="tarafAdres" rows="3"></textarea>
        </div>

        <h3 style="margin: 30px 0 20px; color: var(--primary);">
          <i class="fas fa-user-tie"></i> Avukat Bilgileri
        </h3>

        <div class="form-grid">
          <div class="form-group">
            <label>Avukat Adı</label>
            <input type="text" id="avukatAd">
          </div>
          <div class="form-group">
            <label>Avukat Soyadı</label>
            <input type="text" id="avukatSoyad">
          </div>
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label>Avukat TC</label>
            <input type="text" id="avukatTC" pattern="[0-9]{11}" maxlength="11">
          </div>
          <div class="form-group">
            <label>Baro Sicil No</label>
            <input type="text" id="baroSicilNo">
          </div>
        </div>

        <h3 style="margin: 30px 0 20px; color: var(--primary);">
          <i class="fas fa-info-circle"></i> Dava Detayları
        </h3>

        <div class="form-grid">
          <div class="form-group">
            <label>Dava Türü *</label>
            <select id="davaTuru" required>
              <option value="">Seçiniz</option>
              <option value="Boşanma">Boşanma</option>
              <option value="Nafaka">Nafaka</option>
              <option value="Velayet">Velayet</option>
              <option value="Miras">Miras</option>
              <option value="Alacak">Alacak</option>
              <option value="Tazminat">Tazminat</option>
              <option value="İş Davası">İş Davası</option>
              <option value="Ticari Dava">Ticari Dava</option>
              <option value="Ceza Davası">Ceza Davası</option>
            </select>
          </div>
          <div class="form-group">
            <label>Durum *</label>
            <select id="durum" required>
              <option value="Aktif">Aktif</option>
              <option value="Beklemede">Beklemede</option>
              <option value="Kapalı">Kapalı</option>
            </select>
          </div>
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label>Öncelik *</label>
            <select id="oncelik" required>
              <option value="Normal">Normal</option>
              <option value="Önemli">Önemli</option>
              <option value="Acil">Acil</option>
            </select>
          </div>
          <div class="form-group">
            <label>Açılış Tarihi *</label>
            <input type="date" id="acilisTarihi" required>
          </div>
        </div>

        <h3 style="margin: 30px 0 20px; color: var(--success);">
          <i class="fas fa-coins"></i> Vekalet Ücreti
        </h3>

        <div class="form-grid">
          <div class="form-group">
            <label>Vekalet Ücreti (₺)</label>
            <input type="number" id="vekaletUcreti" min="0" step="0.01">
          </div>
          <div class="form-group">
            <label>Durum</label>
            <select id="vekaletDurum">
              <option value="">Seçiniz</option>
              <option value="Tahsil Edildi">Tahsil Edildi</option>
              <option value="Tahsil Bekliyor">Tahsil Bekliyor</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label>Vekalet Notu</label>
          <textarea id="vekaletNotu" rows="2"></textarea>
        </div>

        <div class="form-group">
          <label>Notlar</label>
          <textarea id="notlar" rows="4"></textarea>
        </div>

        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 30px;">
          <button type="button" class="btn btn-secondary" onclick="closeModal('addCaseModal')">
            <i class="fas fa-times"></i> İptal
          </button>
          <button type="submit" class="btn btn-success">
            <i class="fas fa-save"></i> Kaydet
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- EDIT CASE MODAL -->
  <div id="editCaseModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2><i class="fas fa-edit"></i> Dava Düzenle</h2>
        <span class="close" onclick="closeModal('editCaseModal')">&times;</span>
      </div>
      <form onsubmit="updateCase(event)">
        <input type="hidden" id="editCaseId">
        
        <h3 style="margin-bottom: 20px; color: var(--primary);">
          <i class="fas fa-gavel"></i> Dava Bilgileri
        </h3>
        
        <div class="form-grid">
          <div class="form-group">
            <label>Esas No *</label>
            <input type="text" id="editEsasNo" required>
          </div>
          <div class="form-group">
            <label>Mahkeme Türü *</label>
            <select id="editMahkemeTuru" required>
              <option value="Asliye Hukuk">Asliye Hukuk</option>
              <option value="Asliye Ceza">Asliye Ceza</option>
              <option value="Ağır Ceza">Ağır Ceza</option>
              <option value="İcra">İcra</option>
              <option value="Aile">Aile</option>
              <option value="İş">İş</option>
              <option value="Ticaret">Ticaret</option>
              <option value="İdare">İdare</option>
            </select>
          </div>
        </div>

        <h3 style="margin: 30px 0 20px; color: var(--primary);">
          <i class="fas fa-user"></i> Taraf Bilgileri
        </h3>

        <div class="form-grid">
          <div class="form-group">
            <label>Taraf Adı *</label>
            <input type="text" id="editTarafAd" required>
          </div>
          <div class="form-group">
            <label>Taraf Soyadı *</label>
            <input type="text" id="editTarafSoyad" required>
          </div>
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label>TC Kimlik No *</label>
            <input type="text" id="editTarafTC" required pattern="[0-9]{11}" maxlength="11">
          </div>
          <div class="form-group">
            <label>Telefon</label>
            <input type="tel" id="editTarafTelefon">
          </div>
        </div>

        <div class="form-group">
          <label>E-posta</label>
          <input type="email" id="editTarafEmail">
        </div>

        <div class="form-group">
          <label>Adres</label>
          <textarea id="editTarafAdres" rows="3"></textarea>
        </div>

        <h3 style="margin: 30px 0 20px; color: var(--primary);">
          <i class="fas fa-user-tie"></i> Avukat Bilgileri
        </h3>

        <div class="form-grid">
          <div class="form-group">
            <label>Avukat Adı</label>
            <input type="text" id="editAvukatAd">
          </div>
          <div class="form-group">
            <label>Avukat Soyadı</label>
            <input type="text" id="editAvukatSoyad">
          </div>
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label>Avukat TC</label>
            <input type="text" id="editAvukatTC" pattern="[0-9]{11}" maxlength="11">
          </div>
          <div class="form-group">
            <label>Baro Sicil No</label>
            <input type="text" id="editBaroSicilNo">
          </div>
        </div>

        <h3 style="margin: 30px 0 20px; color: var(--primary);">
          <i class="fas fa-info-circle"></i> Dava Detayları
        </h3>

        <div class="form-grid">
          <div class="form-group">
            <label>Dava Türü *</label>
            <select id="editDavaTuru" required>
              <option value="Boşanma">Boşanma</option>
              <option value="Nafaka">Nafaka</option>
              <option value="Velayet">Velayet</option>
              <option value="Miras">Miras</option>
              <option value="Alacak">Alacak</option>
              <option value="Tazminat">Tazminat</option>
              <option value="İş Davası">İş Davası</option>
              <option value="Ticari Dava">Ticari Dava</option>
              <option value="Ceza Davası">Ceza Davası</option>
            </select>
          </div>
          <div class="form-group">
            <label>Durum *</label>
            <select id="editDurum" required>
              <option value="Aktif">Aktif</option>
              <option value="Beklemede">Beklemede</option>
              <option value="Kapalı">Kapalı</option>
            </select>
          </div>
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label>Öncelik *</label>
            <select id="editOncelik" required>
              <option value="Normal">Normal</option>
              <option value="Önemli">Önemli</option>
              <option value="Acil">Acil</option>
            </select>
          </div>
          <div class="form-group">
            <label>Açılış Tarihi *</label>
            <input type="date" id="editAcilisTarihi" required>
          </div>
        </div>

        <h3 style="margin: 30px 0 20px; color: var(--success);">
          <i class="fas fa-coins"></i> Vekalet Ücreti
        </h3>

        <div class="form-grid">
          <div class="form-group">
            <label>Vekalet Ücreti (₺)</label>
            <input type="number" id="editVekaletUcreti" min="0" step="0.01">
          </div>
          <div class="form-group">
            <label>Durum</label>
            <select id="editVekaletDurum">
              <option value="">Seçiniz</option>
              <option value="Tahsil Edildi">Tahsil Edildi</option>
              <option value="Tahsil Bekliyor">Tahsil Bekliyor</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label>Vekalet Notu</label>
          <textarea id="editVekaletNotu" rows="2"></textarea>
        </div>

        <div class="form-group">
          <label>Notlar</label>
          <textarea id="editNotlar" rows="4"></textarea>
        </div>

        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 30px;">
          <button type="button" class="btn btn-secondary" onclick="closeModal('editCaseModal')">
            <i class="fas fa-times"></i> İptal
          </button>
          <button type="submit" class="btn btn-success">
            <i class="fas fa-save"></i> Güncelle
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- VIEW CASE MODAL -->
  <div id="viewCaseModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2><i class="fas fa-eye"></i> Dava Detayları</h2>
        <span class="close" onclick="closeModal('viewCaseModal')">&times;</span>
      </div>
      <div id="caseDetailContent"></div>
    </div>
  </div>

  <!-- ADD HEARING MODAL -->
  <div id="addHearingModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2><i class="fas fa-plus"></i> Yeni Duruşma Ekle</h2>
        <span class="close" onclick="closeModal('addHearingModal')">&times;</span>
      </div>
      <form onsubmit="addHearing(event)">
        <div class="form-group">
          <label>Dava *</label>
          <select id="hearingCaseId" required>
            <option value="">Seçin</option>
          </select>
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label>Tarih *</label>
            <input type="date" id="hearingDate" required>
          </div>
          <div class="form-group">
            <label>Saat *</label>
            <input type="time" id="hearingTime" required>
          </div>
        </div>

        <div class="form-group">
          <label>Yer</label>
          <input type="text" id="hearingLocation" placeholder="Mahkeme Salonu">
        </div>

        <div class="form-group">
          <label>Notlar</label>
          <textarea id="hearingNotes" rows="4"></textarea>
        </div>

        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 30px;">
          <button type="button" class="btn btn-secondary" onclick="closeModal('addHearingModal')">
            <i class="fas fa-times"></i> İptal
          </button>
          <button type="submit" class="btn btn-success">
            <i class="fas fa-save"></i> Kaydet
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- ADD PAYMENT MODAL -->
  <div id="addPaymentModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2><i class="fas fa-plus"></i> Yeni Ödeme Ekle</h2>
        <span class="close" onclick="closeModal('addPaymentModal')">&times;</span>
      </div>
      <form onsubmit="addPayment(event)">
        <div class="form-group">
          <label>Dava *</label>
          <select id="paymentCaseId" required>
            <option value="">Seçin</option>
          </select>
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label>Ödeme Türü *</label>
            <select id="paymentType" required>
              <option value="Vekalet Ücreti">Vekalet Ücreti</option>
              <option value="Harç">Harç</option>
              <option value="Masraf">Masraf</option>
              <option value="Diğer">Diğer</option>
            </select>
          </div>
          <div class="form-group">
            <label>Tutar (₺) *</label>
            <input type="number" id="paymentAmount" required min="0" step="0.01">
          </div>
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label>Durum *</label>
            <select id="paymentStatus" required>
              <option value="Tahsil Edildi">Tahsil Edildi</option>
              <option value="Tahsil Bekliyor">Tahsil Bekliyor</option>
            </select>
          </div>
          <div class="form-group">
            <label>Tarih *</label>
            <input type="date" id="paymentDate" required>
          </div>
        </div>

        <div class="form-group">
          <label>Açıklama</label>
          <textarea id="paymentDescription" rows="3"></textarea>
        </div>

        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 30px;">
          <button type="button" class="btn btn-secondary" onclick="closeModal('addPaymentModal')">
            <i class="fas fa-times"></i> İptal
          </button>
          <button type="submit" class="btn btn-success">
            <i class="fas fa-save"></i> Kaydet
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- ADD REMINDER MODAL -->
  <div id="addReminderModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2><i class="fas fa-plus"></i> Yeni Hatırlatıcı Ekle</h2>
        <span class="close" onclick="closeModal('addReminderModal')">&times;</span>
      </div>
      <form onsubmit="addReminder(event)">
        <div class="form-group">
          <label>Dava</label>
          <select id="reminderCaseId">
            <option value="">Genel</option>
          </select>
        </div>

        <div class="form-group">
          <label>Başlık *</label>
          <input type="text" id="reminderTitle" required placeholder="Hatırlatıcı başlığı">
        </div>

        <div class="form-group">
          <label>Açıklama</label>
          <textarea id="reminderDescription" rows="3" placeholder="Detaylı açıklama"></textarea>
        </div>

        <div class="form-grid">
          <div class="form-group">
            <label>Tarih *</label>
            <input type="date" id="reminderDate" required>
          </div>
          <div class="form-group">
            <label>Saat</label>
            <input type="time" id="reminderTime" value="09:00">
          </div>
        </div>

        <div class="form-group">
          <label>Öncelik *</label>
          <select id="reminderPriority" required>
            <option value="Normal">Normal</option>
            <option value="Önemli">Önemli</option>
            <option value="Acil">Acil</option>
          </select>
        </div>

        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 30px;">
          <button type="button" class="btn btn-secondary" onclick="closeModal('addReminderModal')">
            <i class="fas fa-times"></i> İptal
          </button>
          <button type="submit" class="btn btn-success">
            <i class="fas fa-save"></i> Kaydet
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- REMINDER ALERT -->
  <div id="reminderAlert" class="reminder-alert">
    <div class="reminder-alert-content">
      <div class="reminder-alert-icon">
        <i class="fas fa-bell"></i>
      </div>
      <h2 class="reminder-alert-title" id="reminderAlertTitle">HATIRLATICI!</h2>
      <p class="reminder-alert-message" id="reminderAlertMessage"></p>
      <div style="display: flex; gap: 15px; justify-content: center; position: relative; z-index: 1;">
        <button class="btn" onclick="closeReminderAlert()">
          <i class="fas fa-check"></i> Anladım
        </button>
        <button class="btn" onclick="snoozeReminder()">
          <i class="fas fa-clock"></i> 5 Dakika Ertele
        </button>
      </div>
    </div>
  </div>

  <!-- ABDULLAH AI CHAT -->
  <button id="abdullahBtn" onclick="toggleAbdullah()">
    <i class="fas fa-robot"></i>
  </button>

  <div id="abdullahChat">
    <div class="abdullah-header">
      <span><i class="fas fa-robot"></i> Abdullah AI Asistan</span>
      <span class="close" onclick="stopAbdullah()" style="background: rgba(255,255,255,0.2); width: 35px; height: 35px; font-size: 1.5em;">&times;</span>
    </div>
    <div class="abdullah-body" id="abdullahChatBody">
      <div class="abdullah-message assistant">
        Merhaba! Ben Abdullah, yapay zeka asistanınızım. "Hey Abdullah" diyerek beni aktif edebilir veya aşağıdan yazabilirsiniz.
      </div>
    </div>
    <div class="abdullah-input">
      <input type="text" id="abdullahInput" placeholder="Mesajınızı yazın..." onkeypress="if(event.key==='Enter') sendToAbdullah()">
      <button class="btn btn-primary" onclick="sendToAbdullah()">
        <i class="fas fa-paper-plane"></i>
      </button>
    </div>
  </div>
  <script>
    // ==================== GLOBAL VARIABLES ====================
    let cases = JSON.parse(localStorage.getItem('cases')) || [];
    let hearings = JSON.parse(localStorage.getItem('hearings')) || [];
    let payments = JSON.parse(localStorage.getItem('payments')) || [];
    let reminders = JSON.parse(localStorage.getItem('reminders')) || [];
    let documents = JSON.parse(localStorage.getItem('documents')) || [];
    let geminiApiKey = localStorage.getItem('geminiApiKey') || '';
    let aiModel = localStorage.getItem('aiModel') || 'gemini-2.5-flash';
    let currentFilter = 'all';
    let calendar;
    let abdullahRecognition = null;
    let recognitionRunning = false;
    let abdullahActive = false;
    let permissionGranted = false;
    let currentReminderAlert = null;

    // ==================== ICS FILE UPLOAD ====================
    function uploadICSFile(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const icsData = e.target.result;
          const jcalData = ICAL.parse(icsData);
          const comp = new ICAL.Component(jcalData);
          const vevents = comp.getAllSubcomponents('vevent');
          
          let addedCount = 0;
          
          vevents.forEach(vevent => {
            const event = new ICAL.Event(vevent);
            
            const summary = event.summary || 'Duruşma';
            const location = event.location || '';
            const description = event.description || '';
            const startDate = event.startDate.toJSDate();
            
            let esasNo = '';
            const esasMatch = summary.match(/\d{4}\/\d+/);
            if (esasMatch) {
              esasNo = esasMatch[0];
            }
            
            let caseId = null;
            if (esasNo) {
              const foundCase = cases.find(c => c.esasNo === esasNo);
              if (foundCase) {
                caseId = foundCase.id;
              }
            }
            
            if (!caseId) {
              const foundCase = cases.find(c => 
                summary.toLowerCase().includes(c.tarafAd.toLowerCase()) ||
                summary.toLowerCase().includes(c.tarafSoyad.toLowerCase())
              );
              if (foundCase) {
                caseId = foundCase.id;
              }
            }
            
            const newHearing = {
              id: Date.now() + Math.random(),
              caseId: caseId,
              date: startDate.toISOString(),
              location: location,
              notes: description,
              summary: summary,
              fromICS: true,
              createdAt: new Date().toISOString()
            };
            
            const exists = hearings.some(h => 
              h.date === newHearing.date && 
              h.summary === newHearing.summary
            );
            
            if (!exists) {
              hearings.push(newHearing);
              addedCount++;
            }
          });
          
          localStorage.setItem('hearings', JSON.stringify(hearings));
          displayHearings();
          updateDashboard();
          updateUpcomingHearings();
          
          showNotification(`✅ ${addedCount} duruşma ICS dosyasından yüklendi!`, 'success');
          
        } catch (error) {
          console.error('ICS Parse Hatası:', error);
          showNotification('❌ ICS dosyası okunamadı! Lütfen geçerli bir UYAP ICS dosyası seçin.', 'danger');
        }
      };
      
      reader.readAsText(file);
      event.target.value = '';
    }

    // ==================== YAKLAŞAN DURUŞMALAR ====================
    function updateUpcomingHearings() {
      const now = new Date();
      const next30Days = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000);
      
      const upcomingHearings = hearings
        .filter(h => {
          const hearingDate = new Date(h.date);
          return hearingDate >= now && hearingDate <= next30Days;
        })
        .sort((a, b) => new Date(a.date) - new Date(b.date))
        .slice(0, 10);
      
      const urgentHearings = upcomingHearings.filter(h => {
        const hearingDate = new Date(h.date);
        const timeDiff = hearingDate - now;
        const hoursDiff = timeDiff / (1000 * 60 * 60);
        return hoursDiff <= 24;
      });
      
      document.getElementById('urgentHearingsCount').textContent = urgentHearings.length;
      
      const listHTML = upcomingHearings.length === 0 
        ? '<p style="text-align: center; color: #999; padding: 20px;">Yaklaşan duruşma bulunmamaktadır.</p>'
        : upcomingHearings.map(h => {
            const caseItem = h.caseId ? cases.find(c => c.id === h.caseId) : null;
            const hearingDate = new Date(h.date);
            const timeDiff = hearingDate - now;
            const hoursDiff = timeDiff / (1000 * 60 * 60);
            const daysDiff = Math.floor(hoursDiff / 24);
            const isUrgent = hoursDiff <= 24;
            
            let countdownText = '';
            if (hoursDiff < 1) {
              countdownText = `${Math.floor(timeDiff / (1000 * 60))} dakika`;
            } else if (hoursDiff < 24) {
              countdownText = `${Math.floor(hoursDiff)} saat`;
            } else {
              countdownText = `${daysDiff} gün`;
            }
            
            return `
              <div class="hearing-item ${isUrgent ? 'urgent-24h' : ''}">
                <div class="hearing-item-header">
                  <div class="hearing-item-title">
                    ${isUrgent ? '<i class="fas fa-exclamation-triangle" style="color: var(--danger);"></i>' : '<i class="fas fa-calendar-alt"></i>'}
                    ${caseItem ? caseItem.esasNo : (h.summary || 'Duruşma')}
                    ${isUrgent ? `<span class="countdown-badge"><i class="fas fa-clock"></i> ${countdownText} kaldı!</span>` : ''}
                  </div>
                  <div class="hearing-item-time">
                    <i class="fas fa-clock"></i>
                    ${hearingDate.toLocaleTimeString('tr-TR', {hour: '2-digit', minute: '2-digit'})}
                  </div>
                </div>
                <div class="hearing-item-details">
                  <div class="hearing-item-detail">
                    <i class="fas fa-calendar"></i>
                    <strong>${hearingDate.toLocaleDateString('tr-TR', {weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'})}</strong>
                  </div>
                  ${caseItem ? `
                    <div class="hearing-item-detail">
                      <i class="fas fa-user"></i>
                      ${caseItem.tarafAd} ${caseItem.tarafSoyad}
                    </div>
                  ` : ''}
                  ${h.location ? `
                    <div class="hearing-item-detail">
                      <i class="fas fa-map-marker-alt"></i>
                      ${h.location}
                    </div>
                  ` : ''}
                  ${!isUrgent ? `
                    <div class="hearing-item-detail">
                      <i class="fas fa-hourglass-half"></i>
                      ${countdownText} sonra
                    </div>
                  ` : ''}
                </div>
                ${h.notes ? `
                  <div style="margin-top: 10px; padding: 10px; background: rgba(99, 102, 241, 0.05); border-radius: 8px; font-size: 0.9em;">
                    <i class="fas fa-sticky-note"></i> ${h.notes}
                  </div>
                ` : ''}
              </div>
            `;
          }).join('');
      
      document.getElementById('upcomingHearingsList').innerHTML = listHTML;
    }

    // ==================== REMINDER ALERT ====================
    function checkReminders() {
      const now = new Date();
      
      reminders.forEach(reminder => {
        if (reminder.completed || reminder.snoozedUntil) return;
        
        const reminderDate = new Date(reminder.date);
        
        if (reminderDate <= now) {
          showReminderAlert(reminder);
        }
      });
    }

    function showReminderAlert(reminder) {
      currentReminderAlert = reminder;
      
      const caseItem = reminder.caseId ? cases.find(c => c.id === reminder.caseId) : null;
      
      let message = reminder.description || reminder.title;
      if (caseItem) {
        message += `\n\nDava: ${caseItem.esasNo} - ${caseItem.tarafAd} ${caseItem.tarafSoyad}`;
      }
      
      document.getElementById('reminderAlertTitle').textContent = reminder.title;
      document.getElementById('reminderAlertMessage').textContent = message;
      document.getElementById('reminderAlert').classList.add('active');
      
      speakText(`Hatırlatıcı: ${reminder.title}`);
      
      if ('Notification' in window && Notification.permission === 'granted') {
        new Notification('🔔 HATIRLATICI!', {
          body: reminder.title,
          icon: '🔔',
          tag: 'reminder-' + reminder.id,
          requireInteraction: true
        });
      }
      
      playNotificationSound();
    }

    function closeReminderAlert() {
      if (currentReminderAlert) {
        const index = reminders.findIndex(r => r.id === currentReminderAlert.id);
        if (index !== -1) {
          reminders[index].completed = true;
          localStorage.setItem('reminders', JSON.stringify(reminders));
          displayReminders();
        }
      }
      
      document.getElementById('reminderAlert').classList.remove('active');
      currentReminderAlert = null;
    }

    function snoozeReminder() {
      if (currentReminderAlert) {
        const index = reminders.findIndex(r => r.id === currentReminderAlert.id);
        if (index !== -1) {
          const snoozeTime = new Date(Date.now() + 5 * 60 * 1000);
          reminders[index].date = snoozeTime.toISOString();
          reminders[index].snoozedUntil = snoozeTime.toISOString();
          localStorage.setItem('reminders', JSON.stringify(reminders));
          showNotification('⏰ Hatırlatıcı 5 dakika ertelendi', 'info');
        }
      }
      
      document.getElementById('reminderAlert').classList.remove('active');
      currentReminderAlert = null;
    }

    function playNotificationSound() {
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      oscillator.frequency.value = 800;
      oscillator.type = 'sine';
      
      gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
      
      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + 0.5);
      
      setTimeout(() => {
        const oscillator2 = audioContext.createOscillator();
        const gainNode2 = audioContext.createGain();
        
        oscillator2.connect(gainNode2);
        gainNode2.connect(audioContext.destination);
        
        oscillator2.frequency.value = 1000;
        oscillator2.type = 'sine';
        
        gainNode2.gain.setValueAtTime(0.3, audioContext.currentTime);
        gainNode2.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
        
        oscillator2.start(audioContext.currentTime);
        oscillator2.stop(audioContext.currentTime + 0.5);
      }, 600);
    }

    // ==================== CASES ====================
    function addCase(event) {
      event.preventDefault();
      
      const newCase = {
        id: Date.now(),
        esasNo: document.getElementById('esasNo').value,
        mahkemeTuru: document.getElementById('mahkemeTuru').value,
        tarafAd: document.getElementById('tarafAd').value,
        tarafSoyad: document.getElementById('tarafSoyad').value,
        tarafTC: document.getElementById('tarafTC').value,
        tarafTelefon: document.getElementById('tarafTelefon').value,
        tarafEmail: document.getElementById('tarafEmail').value,
        tarafAdres: document.getElementById('tarafAdres').value,
        avukatAd: document.getElementById('avukatAd').value,
        avukatSoyad: document.getElementById('avukatSoyad').value,
        avukatTC: document.getElementById('avukatTC').value,
        baroSicilNo: document.getElementById('baroSicilNo').value,
        davaTuru: document.getElementById('davaTuru').value,
        durum: document.getElementById('durum').value,
        oncelik: document.getElementById('oncelik').value,
        acilisTarihi: document.getElementById('acilisTarihi').value,
        vekaletUcreti: document.getElementById('vekaletUcreti').value,
        vekaletDurum: document.getElementById('vekaletDurum').value,
        vekaletNotu: document.getElementById('vekaletNotu').value,
        notlar: document.getElementById('notlar').value,
        favorite: false,
        createdAt: new Date().toISOString()
      };
      
      cases.push(newCase);
      localStorage.setItem('cases', JSON.stringify(cases));
      
      if (newCase.vekaletUcreti && newCase.vekaletDurum) {
        const vekaletPayment = {
          id: Date.now() + 1,
          caseId: newCase.id,
          type: 'Vekalet Ücreti',
          amount: newCase.vekaletUcreti,
          status: newCase.vekaletDurum,
          date: newCase.acilisTarihi,
          description: newCase.vekaletNotu || 'Vekalet ücreti',
          isVekalet: true,
          createdAt: new Date().toISOString()
        };
        payments.push(vekaletPayment);
        localStorage.setItem('payments', JSON.stringify(payments));
      }
      
      closeModal('addCaseModal');
      event.target.reset();
      displayCases();
      updateDashboard();
      showNotification('✅ Dava eklendi!', 'success');
    }

    function displayCases() {
      const casesList = document.getElementById('casesList');
      
      if (cases.length === 0) {
        casesList.innerHTML = '<p style="text-align: center; color: #999; padding: 40px;">Henüz dava bulunmamaktadır.</p>';
        return;
      }

      let filteredCases = cases;
      
      if (currentFilter !== 'all') {
        if (currentFilter === 'favorites') {
          filteredCases = cases.filter(c => c.favorite);
        } else {
          filteredCases = cases.filter(c => c.durum === currentFilter);
        }
      }

      casesList.innerHTML = `
        <div style="overflow-x: auto;">
          <table>
            <thead>
              <tr>
                <th>Esas No</th>
                <th>Mahkeme</th>
                <th>Taraf</th>
                <th>Dava Türü</th>
                <th>Durum</th>
                <th>Öncelik</th>
                <th>Vekalet</th>
                <th>İşlemler</th>
              </tr>
            </thead>
            <tbody>
              ${filteredCases.map(c => `
                <tr>
                  <td><strong>${c.esasNo}</strong></td>
                  <td>${c.mahkemeTuru}</td>
                  <td>${c.tarafAd} ${c.tarafSoyad}</td>
                  <td>${c.davaTuru}</td>
                  <td>
                    <span class="badge badge-${c.durum === 'Aktif' ? 'success' : c.durum === 'Beklemede' ? 'warning' : 'secondary'}">
                      ${c.durum}
                    </span>
                  </td>
                  <td>
                    <span class="badge badge-${c.oncelik === 'Acil' ? 'danger' : c.oncelik === 'Önemli' ? 'warning' : 'info'}">
                      ${c.oncelik}
                    </span>
                  </td>
                  <td>
                    ${c.vekaletUcreti ? `
                      <strong style="color: var(--success);">${parseFloat(c.vekaletUcreti).toLocaleString('tr-TR')} ₺</strong><br>
                      <small class="badge badge-${c.vekaletDurum === 'Tahsil Edildi' ? 'success' : 'warning'}">${c.vekaletDurum || '-'}</small>
                    ` : '-'}
                  </td>
                  <td>
                    <button class="btn btn-sm btn-info" onclick="viewCase(${c.id})" title="Görüntüle">
                      <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn btn-sm btn-warning" onclick="editCase(${c.id})" title="Düzenle">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm ${c.favorite ? 'btn-danger' : 'btn-secondary'}" onclick="toggleFavorite(${c.id})" title="Favori">
                      <i class="fas fa-star"></i>
                    </button>
                    <button class="btn btn-sm btn-danger" onclick="deleteCase(${c.id})" title="Sil">
                      <i class="fas fa-trash"></i>
                    </button>
                  </td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        </div>
      `;
    }

    function editCase(id) {
      const caseItem = cases.find(c => c.id === id);
      if (!caseItem) return;

      document.getElementById('editCaseId').value = caseItem.id;
      document.getElementById('editEsasNo').value = caseItem.esasNo;
      document.getElementById('editMahkemeTuru').value = caseItem.mahkemeTuru;
      document.getElementById('editTarafAd').value = caseItem.tarafAd;
      document.getElementById('editTarafSoyad').value = caseItem.tarafSoyad;
      document.getElementById('editTarafTC').value = caseItem.tarafTC;
      document.getElementById('editTarafTelefon').value = caseItem.tarafTelefon || '';
      document.getElementById('editTarafEmail').value = caseItem.tarafEmail || '';
      document.getElementById('editTarafAdres').value = caseItem.tarafAdres || '';
      document.getElementById('editAvukatAd').value = caseItem.avukatAd || '';
      document.getElementById('editAvukatSoyad').value = caseItem.avukatSoyad || '';
      document.getElementById('editAvukatTC').value = caseItem.avukatTC || '';
      document.getElementById('editBaroSicilNo').value = caseItem.baroSicilNo || '';
      document.getElementById('editDavaTuru').value = caseItem.davaTuru;
      document.getElementById('editDurum').value = caseItem.durum;
      document.getElementById('editOncelik').value = caseItem.oncelik;
      document.getElementById('editAcilisTarihi').value = caseItem.acilisTarihi;
      document.getElementById('editVekaletUcreti').value = caseItem.vekaletUcreti || '';
      document.getElementById('editVekaletDurum').value = caseItem.vekaletDurum || '';
      document.getElementById('editVekaletNotu').value = caseItem.vekaletNotu || '';
      document.getElementById('editNotlar').value = caseItem.notlar || '';

      openModal('editCaseModal');
    }

    function updateCase(event) {
      event.preventDefault();
      
      const id = parseInt(document.getElementById('editCaseId').value);
      const index = cases.findIndex(c => c.id === id);
      
      if (index !== -1) {
        cases[index] = {
          ...cases[index],
          esasNo: document.getElementById('editEsasNo').value,
          mahkemeTuru: document.getElementById('editMahkemeTuru').value,
          tarafAd: document.getElementById('editTarafAd').value,
          tarafSoyad: document.getElementById('editTarafSoyad').value,
          tarafTC: document.getElementById('editTarafTC').value,
          tarafTelefon: document.getElementById('editTarafTelefon').value,
          tarafEmail: document.getElementById('editTarafEmail').value,
          tarafAdres: document.getElementById('editTarafAdres').value,
          avukatAd: document.getElementById('editAvukatAd').value,
          avukatSoyad: document.getElementById('editAvukatSoyad').value,
          avukatTC: document.getElementById('editAvukatTC').value,
          baroSicilNo: document.getElementById('editBaroSicilNo').value,
          davaTuru: document.getElementById('editDavaTuru').value,
          durum: document.getElementById('editDurum').value,
          oncelik: document.getElementById('editOncelik').value,
          acilisTarihi: document.getElementById('editAcilisTarihi').value,
          vekaletUcreti: document.getElementById('editVekaletUcreti').value,
          vekaletDurum: document.getElementById('editVekaletDurum').value,
          vekaletNotu: document.getElementById('editVekaletNotu').value,
          notlar: document.getElementById('editNotlar').value,
          updatedAt: new Date().toISOString()
        };
        
        localStorage.setItem('cases', JSON.stringify(cases));
        closeModal('editCaseModal');
        displayCases();
        updateDashboard();
        showNotification('✅ Dava güncellendi!', 'success');
      }
    }

    function viewCase(id) {
      const caseItem = cases.find(c => c.id === id);
      if (!caseItem) return;

      const content = `
        <div class="info-grid">
          <div class="info-item">
            <label>Esas No</label>
            <div class="value">${caseItem.esasNo}</div>
          </div>
          <div class="info-item">
            <label>Mahkeme</label>
            <div class="value">${caseItem.mahkemeTuru}</div>
          </div>
          <div class="info-item">
            <label>Dava Türü</label>
            <div class="value">${caseItem.davaTuru}</div>
          </div>
          <div class="info-item">
            <label>Durum</label>
            <div class="value">
              <span class="badge badge-${caseItem.durum === 'Aktif' ? 'success' : caseItem.durum === 'Beklemede' ? 'warning' : 'secondary'}">
                ${caseItem.durum}
              </span>
            </div>
          </div>
          <div class="info-item">
            <label>Öncelik</label>
            <div class="value">
              <span class="badge badge-${caseItem.oncelik === 'Acil' ? 'danger' : caseItem.oncelik === 'Önemli' ? 'warning' : 'info'}">
                ${caseItem.oncelik}
              </span>
            </div>
          </div>
          <div class="info-item">
            <label>Açılış Tarihi</label>
            <div class="value">${new Date(caseItem.acilisTarihi).toLocaleDateString('tr-TR')}</div>
          </div>
        </div>

        <h3 style="margin: 30px 0 20px; color: var(--primary);">
          <i class="fas fa-user"></i> Taraf Bilgileri
        </h3>

        <div class="info-grid">
          <div class="info-item">
            <label>Ad Soyad</label>
            <div class="value">${caseItem.tarafAd} ${caseItem.tarafSoyad}</div>
          </div>
          <div class="info-item">
            <label>TC Kimlik</label>
            <div class="value">${caseItem.tarafTC}</div>
          </div>
          ${caseItem.tarafTelefon ? `
            <div class="info-item">
              <label>Telefon</label>
              <div class="value">${caseItem.tarafTelefon}</div>
            </div>
          ` : ''}
          ${caseItem.tarafEmail ? `
            <div class="info-item">
              <label>E-posta</label>
              <div class="value">${caseItem.tarafEmail}</div>
            </div>
          ` : ''}
        </div>

        ${caseItem.tarafAdres ? `
          <div class="info-item" style="margin-top: 20px;">
            <label>Adres</label>
            <div class="value">${caseItem.tarafAdres}</div>
          </div>
        ` : ''}

        ${caseItem.avukatAd ? `
          <h3 style="margin: 30px 0 20px; color: var(--primary);">
            <i class="fas fa-user-tie"></i> Avukat Bilgileri
          </h3>

          <div class="info-grid">
            <div class="info-item">
              <label>Ad Soyad</label>
              <div class="value">${caseItem.avukatAd} ${caseItem.avukatSoyad || ''}</div>
            </div>
            ${caseItem.avukatTC ? `
              <div class="info-item">
                <label>TC Kimlik</label>
                <div class="value">${caseItem.avukatTC}</div>
              </div>
            ` : ''}
            ${caseItem.baroSicilNo ? `
              <div class="info-item">
                <label>Baro Sicil No</label>
                <div class="value">${caseItem.baroSicilNo}</div>
              </div>
            ` : ''}
          </div>
        ` : ''}

        ${caseItem.vekaletUcreti ? `
          <h3 style="margin: 30px 0 20px; color: var(--success);">
            <i class="fas fa-coins"></i> Vekalet Ücreti
          </h3>

          <div class="info-grid">
            <div class="info-item">
              <label>Tutar</label>
              <div class="value" style="color: var(--success); font-size: 1.3em;">${parseFloat(caseItem.vekaletUcreti).toLocaleString('tr-TR')} ₺</div>
            </div>
            ${caseItem.vekaletDurum ? `
              <div class="info-item">
                <label>Durum</label>
                <div class="value">
                  <span class="badge badge-${caseItem.vekaletDurum === 'Tahsil Edildi' ? 'success' : 'warning'}">
                    ${caseItem.vekaletDurum}
                  </span>
                </div>
              </div>
            ` : ''}
          </div>

          ${caseItem.vekaletNotu ? `
            <div class="info-item" style="margin-top: 20px;">
              <label>Not</label>
              <div class="value">${caseItem.vekaletNotu}</div>
            </div>
          ` : ''}
        ` : ''}

        ${caseItem.notlar ? `
          <h3 style="margin: 30px 0 20px; color: var(--primary);">
            <i class="fas fa-sticky-note"></i> Notlar
          </h3>
          <div class="info-item">
            <div class="value">${caseItem.notlar}</div>
          </div>
        ` : ''}

        <div style="margin-top: 30px; display: flex; gap: 10px; justify-content: flex-end;">
          <button class="btn btn-warning" onclick="closeModal('viewCaseModal'); editCase(${caseItem.id})">
            <i class="fas fa-edit"></i> Düzenle
          </button>
          <button class="btn btn-secondary" onclick="closeModal('viewCaseModal')">
            <i class="fas fa-times"></i> Kapat
          </button>
        </div>
      `;

      document.getElementById('caseDetailContent').innerHTML = content;
      openModal('viewCaseModal');
    }

    function deleteCase(id) {
      if (!confirm('Bu davayı silmek istediğinizden emin misiniz?')) return;
      
      cases = cases.filter(c => c.id !== id);
      hearings = hearings.filter(h => h.caseId !== id);
      payments = payments.filter(p => p.caseId !== id);
      
      localStorage.setItem('cases', JSON.stringify(cases));
      localStorage.setItem('hearings', JSON.stringify(hearings));
      localStorage.setItem('payments', JSON.stringify(payments));
      
      displayCases();
      updateDashboard();
      showNotification('🗑️ Dava silindi!', 'info');
    }

    function toggleFavorite(id) {
      const index = cases.findIndex(c => c.id === id);
      if (index !== -1) {
        cases[index].favorite = !cases[index].favorite;
        localStorage.setItem('cases', JSON.stringify(cases));
        displayCases();
        showNotification(cases[index].favorite ? '⭐ Favorilere eklendi!' : '❌ Favorilerden çıkarıldı!', 'info');
      }
    }

    function filterCases(filter) {
      currentFilter = filter;
      displayCases();
    }

    function advancedSearch() {
      const esasNo = document.getElementById('searchEsasNo').value.toLowerCase();
      const tarafAd = document.getElementById('searchTarafAd').value.toLowerCase();
      const tarafSoyad = document.getElementById('searchTarafSoyad').value.toLowerCase();
      const tc = document.getElementById('searchTC').value;
      const avukatTC = document.getElementById('searchAvukatTC').value;
      const mahkeme = document.getElementById('searchMahkeme').value;

      const filtered = cases.filter(c => {
        return (!esasNo || c.esasNo.toLowerCase().includes(esasNo)) &&
               (!tarafAd || c.tarafAd.toLowerCase().includes(tarafAd)) &&
               (!tarafSoyad || c.tarafSoyad.toLowerCase().includes(tarafSoyad)) &&
               (!tc || c.tarafTC.includes(tc)) &&
               (!avukatTC || (c.avukatTC && c.avukatTC.includes(avukatTC))) &&
               (!mahkeme || c.mahkemeTuru === mahkeme);
      });

      const casesList = document.getElementById('casesList');
      
      if (filtered.length === 0) {
        casesList.innerHTML = '<p style="text-align: center; color: #999; padding: 40px;">Arama kriterlerine uygun dava bulunamadı.</p>';
        return;
      }

      casesList.innerHTML = `
        <div style="overflow-x: auto;">
          <table>
            <thead>
              <tr>
                <th>Esas No</th>
                <th>Mahkeme</th>
                <th>Taraf</th>
                <th>Dava Türü</th>
                <th>Durum</th>
                <th>Öncelik</th>
                <th>Vekalet</th>
                <th>İşlemler</th>
              </tr>
            </thead>
            <tbody>
              ${filtered.map(c => `
                <tr>
                  <td><strong>${c.esasNo}</strong></td>
                  <td>${c.mahkemeTuru}</td>
                  <td>${c.tarafAd} ${c.tarafSoyad}</td>
                  <td>${c.davaTuru}</td>
                  <td>
                    <span class="badge badge-${c.durum === 'Aktif' ? 'success' : c.durum === 'Beklemede' ? 'warning' : 'secondary'}">
                      ${c.durum}
                    </span>
                  </td>
                  <td>
                    <span class="badge badge-${c.oncelik === 'Acil' ? 'danger' : c.oncelik === 'Önemli' ? 'warning' : 'info'}">
                      ${c.oncelik}
                    </span>
                  </td>
                  <td>
                    ${c.vekaletUcreti ? `
                      <strong style="color: var(--success);">${parseFloat(c.vekaletUcreti).toLocaleString('tr-TR')} ₺</strong><br>
                      <small class="badge badge-${c.vekaletDurum === 'Tahsil Edildi' ? 'success' : 'warning'}">${c.vekaletDurum || '-'}</small>
                    ` : '-'}
                  </td>
                  <td>
                    <button class="btn btn-sm btn-info" onclick="viewCase(${c.id})">
                      <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn btn-sm btn-warning" onclick="editCase(${c.id})">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm ${c.favorite ? 'btn-danger' : 'btn-secondary'}" onclick="toggleFavorite(${c.id})">
                      <i class="fas fa-star"></i>
                    </button>
                    <button class="btn btn-sm btn-danger" onclick="deleteCase(${c.id})">
                      <i class="fas fa-trash"></i>
                    </button>
                  </td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        </div>
      `;
    }

    function clearSearch() {
      document.getElementById('searchEsasNo').value = '';
      document.getElementById('searchTarafAd').value = '';
      document.getElementById('searchTarafSoyad').value = '';
      document.getElementById('searchTC').value = '';
      document.getElementById('searchAvukatTC').value = '';
      document.getElementById('searchMahkeme').value = '';
      displayCases();
    }
    // ==================== HEARINGS ====================
    function addHearing(event) {
      event.preventDefault();
      
      const date = document.getElementById('hearingDate').value;
      const time = document.getElementById('hearingTime').value;
      const dateTime = new Date(`${date}T${time}`);
      
      const newHearing = {
        id: Date.now(),
        caseId: parseInt(document.getElementById('hearingCaseId').value),
        date: dateTime.toISOString(),
        location: document.getElementById('hearingLocation').value,
        notes: document.getElementById('hearingNotes').value,
        createdAt: new Date().toISOString()
      };
      
      hearings.push(newHearing);
      localStorage.setItem('hearings', JSON.stringify(hearings));
      
      closeModal('addHearingModal');
      event.target.reset();
      displayHearings();
      updateDashboard();
      updateUpcomingHearings();
      showNotification('✅ Duruşma eklendi!', 'success');
    }

    function displayHearings() {
      const hearingsList = document.getElementById('hearingsList');
      
      if (hearings.length === 0) {
        hearingsList.innerHTML = '<p style="text-align: center; color: #999; padding: 40px;">Henüz duruşma bulunmamaktadır.</p>';
        return;
      }

      const sortedHearings = [...hearings].sort((a, b) => new Date(b.date) - new Date(a.date));

      hearingsList.innerHTML = `
        <div style="overflow-x: auto;">
          <table>
            <thead>
              <tr>
                <th>Dava</th>
                <th>Tarih</th>
                <th>Saat</th>
                <th>Yer</th>
                <th>Notlar</th>
                <th>İşlemler</th>
              </tr>
            </thead>
            <tbody>
              ${sortedHearings.map(h => {
                const caseItem = cases.find(c => c.id === h.caseId);
                const hearingDate = new Date(h.date);
                const now = new Date();
                const isPast = hearingDate < now;
                const isToday = hearingDate.toDateString() === now.toDateString();
                
                return `
                  <tr style="${isPast ? 'opacity: 0.6;' : ''} ${isToday ? 'background: rgba(245, 158, 11, 0.1);' : ''}">
                    <td>
                      ${caseItem ? `
                        <strong>${caseItem.esasNo}</strong><br>
                        <small>${caseItem.tarafAd} ${caseItem.tarafSoyad}</small>
                      ` : (h.summary || '<em>Dava bulunamadı</em>')}
                      ${h.fromICS ? '<br><span class="badge badge-info"><i class="fas fa-calendar-alt"></i> ICS</span>' : ''}
                    </td>
                    <td>
                      <strong>${hearingDate.toLocaleDateString('tr-TR', {weekday: 'short', day: 'numeric', month: 'short', year: 'numeric'})}</strong>
                      ${isToday ? '<br><span class="badge badge-warning">BUGÜN</span>' : ''}
                      ${isPast ? '<br><span class="badge badge-secondary">Geçmiş</span>' : ''}
                    </td>
                    <td><strong style="font-size: 1.1em;">${hearingDate.toLocaleTimeString('tr-TR', {hour: '2-digit', minute: '2-digit'})}</strong></td>
                    <td>${h.location || '-'}</td>
                    <td>${h.notes ? `<small>${h.notes.substring(0, 50)}${h.notes.length > 50 ? '...' : ''}</small>` : '-'}</td>
                    <td>
                      <button class="btn btn-sm btn-danger" onclick="deleteHearing(${h.id})" title="Sil">
                        <i class="fas fa-trash"></i>
                      </button>
                    </td>
                  </tr>
                `;
              }).join('')}
            </tbody>
          </table>
        </div>
      `;
    }

    function deleteHearing(id) {
      if (!confirm('Bu duruşmayı silmek istediğinizden emin misiniz?')) return;
      
      hearings = hearings.filter(h => h.id !== id);
      localStorage.setItem('hearings', JSON.stringify(hearings));
      
      displayHearings();
      updateDashboard();
      updateUpcomingHearings();
      showNotification('🗑️ Duruşma silindi!', 'info');
    }

    // ==================== PAYMENTS ====================
    function addPayment(event) {
      event.preventDefault();
      
      const newPayment = {
        id: Date.now(),
        caseId: parseInt(document.getElementById('paymentCaseId').value),
        type: document.getElementById('paymentType').value,
        amount: parseFloat(document.getElementById('paymentAmount').value),
        status: document.getElementById('paymentStatus').value,
        date: document.getElementById('paymentDate').value,
        description: document.getElementById('paymentDescription').value,
        isVekalet: document.getElementById('paymentType').value === 'Vekalet Ücreti',
        createdAt: new Date().toISOString()
      };
      
      payments.push(newPayment);
      localStorage.setItem('payments', JSON.stringify(payments));
      
      closeModal('addPaymentModal');
      event.target.reset();
      displayPayments();
      updateDashboard();
      showNotification('✅ Ödeme eklendi!', 'success');
    }

    function displayPayments() {
      const paymentsList = document.getElementById('paymentsList');
      
      if (payments.length === 0) {
        paymentsList.innerHTML = '<p style="text-align: center; color: #999; padding: 40px;">Henüz ödeme kaydı bulunmamaktadır.</p>';
        return;
      }

      const sortedPayments = [...payments].sort((a, b) => new Date(b.date) - new Date(a.date));

      let totalPaid = 0;
      let totalPending = 0;
      let vekaletPaid = 0;
      let vekaletPending = 0;

      payments.forEach(p => {
        if (p.status === 'Tahsil Edildi') {
          totalPaid += p.amount;
          if (p.isVekalet) vekaletPaid += p.amount;
        } else {
          totalPending += p.amount;
          if (p.isVekalet) vekaletPending += p.amount;
        }
      });

      document.getElementById('totalPaidDetail').textContent = totalPaid.toLocaleString('tr-TR') + ' ₺';
      document.getElementById('totalPendingDetail').textContent = totalPending.toLocaleString('tr-TR') + ' ₺';
      document.getElementById('vekaletUcretiPaid').textContent = vekaletPaid.toLocaleString('tr-TR') + ' ₺';
      document.getElementById('vekaletUcretiPending').textContent = vekaletPending.toLocaleString('tr-TR') + ' ₺';

      paymentsList.innerHTML = `
        <div style="overflow-x: auto;">
          <table>
            <thead>
              <tr>
                <th>Dava</th>
                <th>Ödeme Türü</th>
                <th>Tutar</th>
                <th>Durum</th>
                <th>Tarih</th>
                <th>Açıklama</th>
                <th>İşlemler</th>
              </tr>
            </thead>
            <tbody>
              ${sortedPayments.map(p => {
                const caseItem = cases.find(c => c.id === p.caseId);
                
                return `
                  <tr>
                    <td>
                      ${caseItem ? `
                        <strong>${caseItem.esasNo}</strong><br>
                        <small>${caseItem.tarafAd} ${caseItem.tarafSoyad}</small>
                      ` : '<em>Dava bulunamadı</em>'}
                    </td>
                    <td>
                      <strong>${p.type}</strong>
                      ${p.isVekalet ? '<br><span class="badge badge-info"><i class="fas fa-coins"></i> Vekalet</span>' : ''}
                    </td>
                    <td><strong style="font-size: 1.2em; color: ${p.status === 'Tahsil Edildi' ? 'var(--success)' : 'var(--warning)'};">${p.amount.toLocaleString('tr-TR')} ₺</strong></td>
                    <td>
                      <span class="payment-status payment-${p.status === 'Tahsil Edildi' ? 'paid' : 'pending'}">
                        <i class="fas fa-${p.status === 'Tahsil Edildi' ? 'check-circle' : 'clock'}"></i>
                        ${p.status}
                      </span>
                    </td>
                    <td>${new Date(p.date).toLocaleDateString('tr-TR')}</td>
                    <td>${p.description ? `<small>${p.description.substring(0, 40)}${p.description.length > 40 ? '...' : ''}</small>` : '-'}</td>
                    <td>
                      <button class="btn btn-sm btn-danger" onclick="deletePayment(${p.id})" title="Sil">
                        <i class="fas fa-trash"></i>
                      </button>
                    </td>
                  </tr>
                `;
              }).join('')}
            </tbody>
          </table>
        </div>
      `;
    }

    function deletePayment(id) {
      if (!confirm('Bu ödeme kaydını silmek istediğinizden emin misiniz?')) return;
      
      payments = payments.filter(p => p.id !== id);
      localStorage.setItem('payments', JSON.stringify(payments));
      
      displayPayments();
      updateDashboard();
      showNotification('🗑️ Ödeme kaydı silindi!', 'info');
    }

    // ==================== REMINDERS ====================
    function addReminder(event) {
      event.preventDefault();
      
      const date = document.getElementById('reminderDate').value;
      const time = document.getElementById('reminderTime').value;
      const dateTime = new Date(`${date}T${time}`);
      
      const newReminder = {
        id: Date.now(),
        caseId: document.getElementById('reminderCaseId').value ? parseInt(document.getElementById('reminderCaseId').value) : null,
        title: document.getElementById('reminderTitle').value,
        description: document.getElementById('reminderDescription').value,
        date: dateTime.toISOString(),
        priority: document.getElementById('reminderPriority').value,
        completed: false,
        createdAt: new Date().toISOString()
      };
      
      reminders.push(newReminder);
      localStorage.setItem('reminders', JSON.stringify(reminders));
      
      closeModal('addReminderModal');
      event.target.reset();
      displayReminders();
      showNotification('✅ Hatırlatıcı eklendi!', 'success');
    }

    function displayReminders() {
      const remindersList = document.getElementById('remindersList');
      
      if (reminders.length === 0) {
        remindersList.innerHTML = '<p style="text-align: center; color: #999; padding: 40px;">Henüz hatırlatıcı bulunmamaktadır.</p>';
        return;
      }

      const sortedReminders = [...reminders].sort((a, b) => new Date(a.date) - new Date(b.date));
      const now = new Date();

      remindersList.innerHTML = sortedReminders.map(r => {
        const caseItem = r.caseId ? cases.find(c => c.id === r.caseId) : null;
        const reminderDate = new Date(r.date);
        const isPast = reminderDate < now;
        const isToday = reminderDate.toDateString() === now.toDateString();
        const timeDiff = reminderDate - now;
        const hoursDiff = timeDiff / (1000 * 60 * 60);
        const isUrgent = hoursDiff <= 24 && hoursDiff > 0;
        
        return `
          <div class="reminder-card ${r.completed ? 'priority-low' : isUrgent ? 'urgent' : r.priority === 'Acil' ? 'priority-high' : r.priority === 'Önemli' ? 'priority-medium' : 'priority-low'}" style="${r.completed ? 'opacity: 0.5;' : ''}">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
              <div>
                <h3 style="font-size: 1.3em; font-weight: 700; margin-bottom: 8px; display: flex; align-items: center; gap: 10px;">
                  <i class="fas fa-${r.completed ? 'check-circle' : isUrgent ? 'exclamation-triangle' : 'bell'}"></i>
                  ${r.title}
                  ${r.completed ? '<span class="badge badge-secondary">Tamamlandı</span>' : ''}
                  ${isUrgent ? '<span class="badge badge-danger">ACİL</span>' : ''}
                  ${isToday ? '<span class="badge badge-warning">BUGÜN</span>' : ''}
                </h3>
                ${caseItem ? `
                  <p style="color: var(--primary); font-weight: 600; margin-bottom: 8px;">
                    <i class="fas fa-folder"></i> ${caseItem.esasNo} - ${caseItem.tarafAd} ${caseItem.tarafSoyad}
                  </p>
                ` : ''}
                ${r.description ? `<p style="color: #666; margin-bottom: 12px;">${r.description}</p>` : ''}
              </div>
              <span class="badge badge-${r.priority === 'Acil' ? 'danger' : r.priority === 'Önemli' ? 'warning' : 'info'}">
                ${r.priority}
              </span>
            </div>
            
            <div style="display: flex; justify-content: space-between; align-items: center; padding-top: 15px; border-top: 2px solid var(--gray-200);">
              <div>
                <strong style="font-size: 1.1em;">
                  <i class="fas fa-calendar-alt"></i>
                  ${reminderDate.toLocaleDateString('tr-TR', {weekday: 'long', day: 'numeric', month: 'long', year: 'numeric'})}
                </strong>
                <br>
                <strong style="font-size: 1.2em; color: var(--primary);">
                  <i class="fas fa-clock"></i>
                  ${reminderDate.toLocaleTimeString('tr-TR', {hour: '2-digit', minute: '2-digit'})}
                </strong>
                ${isPast && !r.completed ? '<br><span class="badge badge-danger">GEÇMİŞ</span>' : ''}
              </div>
              <div style="display: flex; gap: 8px;">
                ${!r.completed ? `
                  <button class="btn btn-sm btn-success" onclick="completeReminder(${r.id})" title="Tamamla">
                    <i class="fas fa-check"></i>
                  </button>
                ` : ''}
                <button class="btn btn-sm btn-danger" onclick="deleteReminder(${r.id})" title="Sil">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    function completeReminder(id) {
      const index = reminders.findIndex(r => r.id === id);
      if (index !== -1) {
        reminders[index].completed = true;
        localStorage.setItem('reminders', JSON.stringify(reminders));
        displayReminders();
        showNotification('✅ Hatırlatıcı tamamlandı!', 'success');
      }
    }

    function deleteReminder(id) {
      if (!confirm('Bu hatırlatıcıyı silmek istediğinizden emin misiniz?')) return;
      
      reminders = reminders.filter(r => r.id !== id);
      localStorage.setItem('reminders', JSON.stringify(reminders));
      
      displayReminders();
      showNotification('🗑️ Hatırlatıcı silindi!', 'info');
    }

    // ==================== DOCUMENTS ====================
    function uploadDocuments() {
      const files = document.getElementById('fileUpload').files;
      if (files.length === 0) {
        showNotification('⚠️ Lütfen dosya seçin!', 'warning');
        return;
      }

      Array.from(files).forEach(file => {
        const reader = new FileReader();
        reader.onload = function(e) {
          const newDoc = {
            id: Date.now() + Math.random(),
            name: file.name,
            type: file.type,
            size: file.size,
            data: e.target.result,
            uploadDate: new Date().toISOString()
          };
          
          documents.push(newDoc);
          localStorage.setItem('documents', JSON.stringify(documents));
          displayDocuments();
        };
        reader.readAsDataURL(file);
      });

      showNotification('✅ Belgeler yükleniyor...', 'success');
      document.getElementById('fileUpload').value = '';
    }

    function uploadWithOCR() {
      const file = document.getElementById('ocrFileUpload').files[0];
      if (!file) {
        showNotification('⚠️ Lütfen resim dosyası seçin!', 'warning');
        return;
      }

      showNotification('🔍 OCR işleniyor, lütfen bekleyin...', 'info');

      Tesseract.recognize(file, 'tur', {
        logger: m => console.log(m)
      }).then(({ data: { text } }) => {
        const reader = new FileReader();
        reader.onload = function(e) {
          const newDoc = {
            id: Date.now(),
            name: file.name,
            type: file.type,
            size: file.size,
            data: e.target.result,
            ocrText: text,
            uploadDate: new Date().toISOString()
          };
          
          documents.push(newDoc);
          localStorage.setItem('documents', JSON.stringify(documents));
          displayDocuments();
          showNotification('✅ OCR tamamlandı!', 'success');
        };
        reader.readAsDataURL(file);
      }).catch(err => {
        console.error('OCR Hatası:', err);
        showNotification('❌ OCR işlemi başarısız!', 'danger');
      });

      document.getElementById('ocrFileUpload').value = '';
    }

    function displayDocuments() {
      const documentsList = document.getElementById('documentsList');
      
      if (documents.length === 0) {
        documentsList.innerHTML = '<p style="text-align: center; color: #999; padding: 40px;">Henüz belge bulunmamaktadır.</p>';
        return;
      }

      const sortedDocs = [...documents].sort((a, b) => new Date(b.uploadDate) - new Date(a.uploadDate));

      documentsList.innerHTML = `
        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px;">
          ${sortedDocs.map(d => {
            const uploadDate = new Date(d.uploadDate);
            const fileIcon = d.type.includes('pdf') ? 'file-pdf' : 
                           d.type.includes('word') ? 'file-word' : 
                           d.type.includes('image') ? 'file-image' : 'file';
            const fileColor = d.type.includes('pdf') ? 'var(--danger)' : 
                            d.type.includes('word') ? 'var(--info)' : 
                            d.type.includes('image') ? 'var(--success)' : 'var(--gray-500)';
            
            return `
              <div class="document-card">
                <div style="text-align: center; margin-bottom: 15px;">
                  <i class="fas fa-${fileIcon}" style="font-size: 4em; color: ${fileColor};"></i>
                </div>
                <h4 style="margin-bottom: 10px; font-weight: 700; word-break: break-word;">${d.name}</h4>
                <p style="color: #666; font-size: 0.9em; margin-bottom: 8px;">
                  <i class="fas fa-calendar"></i> ${uploadDate.toLocaleDateString('tr-TR')}
                </p>
                <p style="color: #666; font-size: 0.9em; margin-bottom: 15px;">
                  <i class="fas fa-hdd"></i> ${(d.size / 1024).toFixed(2)} KB
                </p>
                ${d.ocrText ? `
                  <div style="background: var(--gray-50); padding: 10px; border-radius: 8px; margin-bottom: 15px; max-height: 100px; overflow-y: auto;">
                    <small><strong>OCR Metni:</strong><br>${d.ocrText.substring(0, 150)}${d.ocrText.length > 150 ? '...' : ''}</small>
                  </div>
                ` : ''}
                <div style="display: flex; gap: 8px; justify-content: center;">
                  <a href="${d.data}" download="${d.name}" class="btn btn-sm btn-primary">
                    <i class="fas fa-download"></i> İndir
                  </a>
                  <button class="btn btn-sm btn-danger" onclick="deleteDocument(${d.id})">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </div>
            `;
          }).join('')}
        </div>
      `;
    }

    function deleteDocument(id) {
      if (!confirm('Bu belgeyi silmek istediğinizden emin misiniz?')) return;
      
      documents = documents.filter(d => d.id !== id);
      localStorage.setItem('documents', JSON.stringify(documents));
      
      displayDocuments();
      showNotification('🗑️ Belge silindi!', 'info');
    }

    // ==================== CALENDAR ====================
    function initCalendar() {
      if (calendar) {
        calendar.destroy();
      }

      const calendarEl = document.getElementById('calendarView');
      
      const events = hearings.map(h => {
        const caseItem = h.caseId ? cases.find(c => c.id === h.caseId) : null;
        return {
          title: caseItem ? `${caseItem.esasNo} - ${caseItem.tarafAd} ${caseItem.tarafSoyad}` : (h.summary || 'Duruşma'),
          start: h.date,
          backgroundColor: '#6366f1',
          borderColor: '#4f46e5',
          extendedProps: {
            location: h.location,
            notes: h.notes
          }
        };
      });

      calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        locale: 'tr',
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },
        events: events,
        eventClick: function(info) {
          alert(`📅 ${info.event.title}\n\n⏰ ${info.event.start.toLocaleString('tr-TR')}\n\n📍 ${info.event.extendedProps.location || '-'}\n\n📝 ${info.event.extendedProps.notes || '-'}`);
        },
        height: 'auto'
      });

      calendar.render();
    }

    // ==================== DASHBOARD ====================
    function updateDashboard() {
      document.getElementById('totalCases').textContent = cases.length;
      document.getElementById('activeCases').textContent = cases.filter(c => c.durum === 'Aktif').length;
      
      const now = new Date();
      const next30Days = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000);
      const upcoming = hearings.filter(h => {
        const hDate = new Date(h.date);
        return hDate >= now && hDate <= next30Days;
      });
      document.getElementById('upcomingHearings').textContent = upcoming.length;

      let totalVekalet = 0;
      let tahsilEdilen = 0;
      let tahsilBekleyen = 0;

      cases.forEach(c => {
        if (c.vekaletUcreti) {
          const amount = parseFloat(c.vekaletUcreti);
          totalVekalet += amount;
          if (c.vekaletDurum === 'Tahsil Edildi') {
            tahsilEdilen += amount;
          } else {
            tahsilBekleyen += amount;
          }
        }
      });

      document.getElementById('totalVekaletUcreti').textContent = totalVekalet.toLocaleString('tr-TR') + ' ₺';
      document.getElementById('tahsilEdilen').textContent = tahsilEdilen.toLocaleString('tr-TR') + ' ₺';
      document.getElementById('tahsilBekleyen').textContent = tahsilBekleyen.toLocaleString('tr-TR') + ' ₺';

      updateCharts();
      updateUpcomingHearings();
    }

    function updateCharts() {
      // Case Status Chart
      const statusCounts = {
        'Aktif': cases.filter(c => c.durum === 'Aktif').length,
        'Beklemede': cases.filter(c => c.durum === 'Beklemede').length,
        'Kapalı': cases.filter(c => c.durum === 'Kapalı').length
      };

      const ctx1 = document.getElementById('caseStatusChart');
      if (window.caseStatusChartInstance) {
        window.caseStatusChartInstance.destroy();
      }
      window.caseStatusChartInstance = new Chart(ctx1, {
        type: 'doughnut',
        data: {
          labels: Object.keys(statusCounts),
          datasets: [{
            data: Object.values(statusCounts),
            backgroundColor: ['#10b981', '#f59e0b', '#6b7280']
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'bottom' }
          }
        }
      });

      // Hearing Chart
      const monthCounts = {};
      hearings.forEach(h => {
        const month = new Date(h.date).toLocaleDateString('tr-TR', {month: 'short', year: 'numeric'});
        monthCounts[month] = (monthCounts[month] || 0) + 1;
      });

      const ctx2 = document.getElementById('hearingChart');
      if (window.hearingChartInstance) {
        window.hearingChartInstance.destroy();
      }
      window.hearingChartInstance = new Chart(ctx2, {
        type: 'bar',
        data: {
          labels: Object.keys(monthCounts),
          datasets: [{
            label: 'Duruşma Sayısı',
            data: Object.values(monthCounts),
            backgroundColor: '#6366f1'
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false }
          }
        }
      });

      // Vekalet Chart
      const vekaletData = {
        'Tahsil Edildi': cases.filter(c => c.vekaletDurum === 'Tahsil Edildi').reduce((sum, c) => sum + (parseFloat(c.vekaletUcreti) || 0), 0),
        'Tahsil Bekliyor': cases.filter(c => c.vekaletDurum === 'Tahsil Bekliyor').reduce((sum, c) => sum + (parseFloat(c.vekaletUcreti) || 0), 0)
      };

      const ctx3 = document.getElementById('vekaletChart');
      if (window.vekaletChartInstance) {
        window.vekaletChartInstance.destroy();
      }
      window.vekaletChartInstance = new Chart(ctx3, {
        type: 'line',
        data: {
          labels: Object.keys(vekaletData),
          datasets: [{
            label: 'Tutar (₺)',
            data: Object.values(vekaletData),
            borderColor: '#10b981',
            backgroundColor: 'rgba(16, 185, 129, 0.1)',
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false }
          }
        }
      });
    }
    // ==================== ABDULLAH AI ====================
    function initAbdullahRecognition() {
      if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
        showNotification('❌ Tarayıcınız sesli komut desteklemiyor!', 'danger');
        return false;
      }

      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      abdullahRecognition = new SpeechRecognition();
      abdullahRecognition.lang = 'tr-TR';
      abdullahRecognition.continuous = false;
      abdullahRecognition.interimResults = false;

      abdullahRecognition.onstart = function() {
        recognitionRunning = true;
        permissionGranted = true;
      };

      abdullahRecognition.onresult = function(event) {
        const transcript = event.results[0][0].transcript.toLowerCase().trim();
        
        if (!abdullahActive && (transcript.includes('hey abdullah') || transcript.includes('abdullah'))) {
          activateAbdullah();
          return;
        }

        if (abdullahActive) {
          if (transcript.includes('güle güle') || transcript.includes('kapat')) {
            stopAbdullah();
            return;
          }
          processAbdullahCommand(transcript);
        }
      };

      abdullahRecognition.onerror = function(event) {
        recognitionRunning = false;
        if (event.error === 'not-allowed') {
          permissionGranted = false;
          showNotification('🎤 Mikrofon izni reddedildi', 'danger');
        }
      };

      abdullahRecognition.onend = function() {
        recognitionRunning = false;
        if (permissionGranted && abdullahActive) {
          setTimeout(() => {
            if (!recognitionRunning) {
              try {
                abdullahRecognition.start();
              } catch (error) {}
            }
          }, 500);
        }
      };

      return true;
    }

    function activateAbdullah() {
      abdullahActive = true;
      document.getElementById('abdullahChat').classList.add('active');
      updateAbdullahButton();
      
      const chatBody = document.getElementById('abdullahChatBody');
      chatBody.innerHTML += `<div class="abdullah-message assistant">Evet, dinliyorum. Size nasıl yardımcı olabilirim?</div>`;
      chatBody.scrollTop = chatBody.scrollHeight;
      speakText('Evet, dinliyorum');
    }

    function stopAbdullah() {
      abdullahActive = false;
      document.getElementById('abdullahChat').classList.remove('active');
      updateAbdullahButton();
      
      const chatBody = document.getElementById('abdullahChatBody');
      chatBody.innerHTML += `<div class="abdullah-message assistant">Güle güle, iyi günler dilerim.</div>`;
      chatBody.scrollTop = chatBody.scrollHeight;
      speakText('Güle güle');
    }

    function toggleAbdullah() {
      if (!abdullahRecognition) {
        if (!initAbdullahRecognition()) return;
      }

      if (abdullahActive) {
        stopAbdullah();
      } else {
        if (!recognitionRunning && !permissionGranted) {
          try {
            abdullahRecognition.start();
            setTimeout(() => {
              if (recognitionRunning && permissionGranted) {
                activateAbdullah();
                showNotification('✅ Abdullah AI aktif!', 'success');
              }
            }, 1000);
          } catch (error) {
            showNotification('⚠️ Mikrofon izni gerekli!', 'warning');
          }
        } else if (permissionGranted) {
          if (!recognitionRunning) {
            try {
              abdullahRecognition.start();
            } catch (error) {}
          }
          activateAbdullah();
        }
      }
    }

    function updateAbdullahButton() {
      const btn = document.getElementById('abdullahBtn');
      if (abdullahActive) {
        btn.classList.add('active');
      } else {
        btn.classList.remove('active');
      }
    }

    async function processAbdullahCommand(command) {
      const chatBody = document.getElementById('abdullahChatBody');
      chatBody.innerHTML += `<div class="abdullah-message user">${command}</div>`;
      chatBody.scrollTop = chatBody.scrollHeight;

      // Yerel komutlar
      if (command.includes('dava') && (command.includes('kaç') || command.includes('toplam'))) {
        const response = `Sistemde toplam ${cases.length} dava var. ${cases.filter(c => c.durum === 'Aktif').length} tanesi aktif durumda.`;
        chatBody.innerHTML += `<div class="abdullah-message assistant">${response}</div>`;
        chatBody.scrollTop = chatBody.scrollHeight;
        speakText(response);
        return;
      }

      if (command.includes('duruşma') && (command.includes('kaç') || command.includes('yaklaşan'))) {
        const now = new Date();
        const next30Days = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000);
        const upcoming = hearings.filter(h => {
          const hDate = new Date(h.date);
          return hDate >= now && hDate <= next30Days;
        });
        const response = `Önümüzdeki 30 gün içinde ${upcoming.length} duruşma var.`;
        chatBody.innerHTML += `<div class="abdullah-message assistant">${response}</div>`;
        chatBody.scrollTop = chatBody.scrollHeight;
        speakText(response);
        return;
      }

      if (command.includes('esas') || command.match(/\d{4}\/\d+/)) {
        const esasMatch = command.match(/\d{4}\/\d+/);
        if (esasMatch) {
          const foundCase = cases.find(c => c.esasNo.includes(esasMatch[0]));
          if (foundCase) {
            const response = `${foundCase.esasNo} numaralı dava: ${foundCase.tarafAd} ${foundCase.tarafSoyad}, ${foundCase.mahkemeTuru}, Durum: ${foundCase.durum}`;
            chatBody.innerHTML += `<div class="abdullah-message assistant">${response}</div>`;
            chatBody.scrollTop = chatBody.scrollHeight;
            speakText(response);
            return;
          }
        }
      }

      if (command.includes('merhaba') || command.includes('selam')) {
        const response = 'Merhaba! Size nasıl yardımcı olabilirim?';
        chatBody.innerHTML += `<div class="abdullah-message assistant">${response}</div>`;
        chatBody.scrollTop = chatBody.scrollHeight;
        speakText(response);
        return;
      }

      // Gemini API
      if (!geminiApiKey) {
        const response = 'API anahtarı ayarlanmamış. Lütfen Ayarlar sekmesinden Google Gemini API anahtarınızı girin.';
        chatBody.innerHTML += `<div class="abdullah-message assistant">${response}</div>`;
        chatBody.scrollTop = chatBody.scrollHeight;
        speakText(response);
        return;
      }

      try {
        chatBody.innerHTML += `<div class="abdullah-message assistant" id="loadingMsg">🤔 Düşünüyorum...</div>`;
        chatBody.scrollTop = chatBody.scrollHeight;

        const context = `Sen Abdullah adında bir Türk hukuk asistanısın. Kısa ve öz cevaplar ver.
        
Sistem verileri:
- Toplam Dava: ${cases.length}
- Aktif Dava: ${cases.filter(c => c.durum === 'Aktif').length}
- Yaklaşan Duruşma: ${hearings.filter(h => new Date(h.date) > new Date()).length}

Kullanıcı sorusu: ${command}`;

        const response = await callGeminiAPI(context);
        
        const loadingMsg = document.getElementById('loadingMsg');
        if (loadingMsg) loadingMsg.remove();
        
        chatBody.innerHTML += `<div class="abdullah-message assistant">${response}</div>`;
        chatBody.scrollTop = chatBody.scrollHeight;
        speakText(response.substring(0, 200));

      } catch (error) {
        const loadingMsg = document.getElementById('loadingMsg');
        if (loadingMsg) loadingMsg.remove();
        
        const errorMsg = 'Üzgünüm, bir hata oluştu. Lütfen API anahtarınızı kontrol edin.';
        chatBody.innerHTML += `<div class="abdullah-message assistant">${errorMsg}</div>`;
        chatBody.scrollTop = chatBody.scrollHeight;
        speakText(errorMsg);
      }
    }

    async function sendToAbdullah() {
      const input = document.getElementById('abdullahInput');
      const message = input.value.trim();
      if (!message) return;
      input.value = '';
      await processAbdullahCommand(message);
    }

    async function callGeminiAPI(prompt) {
      const url = `https://generativelanguage.googleapis.com/v1beta/models/${aiModel}:generateContent?key=${geminiApiKey}`;
      const response = await fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          contents: [{ parts: [{ text: prompt }] }],
          generationConfig: { 
            temperature: 0.7, 
            maxOutputTokens: 500,
            topP: 0.8,
            topK: 40
          }
        })
      });
      
      if (!response.ok) {
        throw new Error('API hatası');
      }
      
      const data = await response.json();
      return data.candidates[0].content.parts[0].text;
    }

    function speakText(text) {
      if (!('speechSynthesis' in window)) return;
      speechSynthesis.cancel();
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'tr-TR';
      utterance.rate = 1.0;
      utterance.pitch = 1.0;
      speechSynthesis.speak(utterance);
    }

    function startVoiceSearch() {
      showNotification('🎤 Sağ alttaki mor butona tıklayarak Abdullah AI\'yi aktif edin', 'info');
    }

    // ==================== REPORTS ====================
    function exportToExcel() {
      const wb = XLSX.utils.book_new();
      
      // Davalar
      const casesData = cases.map(c => ({
        'Esas No': c.esasNo,
        'Mahkeme': c.mahkemeTuru,
        'Taraf Adı': c.tarafAd,
        'Taraf Soyadı': c.tarafSoyad,
        'TC': c.tarafTC,
        'Dava Türü': c.davaTuru,
        'Durum': c.durum,
        'Öncelik': c.oncelik,
        'Açılış Tarihi': c.acilisTarihi,
        'Vekalet Ücreti': c.vekaletUcreti || '',
        'Vekalet Durumu': c.vekaletDurum || ''
      }));
      const ws1 = XLSX.utils.json_to_sheet(casesData);
      XLSX.utils.book_append_sheet(wb, ws1, 'Davalar');
      
      // Duruşmalar
      const hearingsData = hearings.map(h => {
        const caseItem = cases.find(c => c.id === h.caseId);
        return {
          'Dava': caseItem ? caseItem.esasNo : '',
          'Tarih': new Date(h.date).toLocaleDateString('tr-TR'),
          'Saat': new Date(h.date).toLocaleTimeString('tr-TR'),
          'Yer': h.location || '',
          'Notlar': h.notes || ''
        };
      });
      const ws2 = XLSX.utils.json_to_sheet(hearingsData);
      XLSX.utils.book_append_sheet(wb, ws2, 'Duruşmalar');
      
      // Ödemeler
      const paymentsData = payments.map(p => {
        const caseItem = cases.find(c => c.id === p.caseId);
        return {
          'Dava': caseItem ? caseItem.esasNo : '',
          'Tür': p.type,
          'Tutar': p.amount,
          'Durum': p.status,
          'Tarih': p.date,
          'Açıklama': p.description || ''
        };
      });
      const ws3 = XLSX.utils.json_to_sheet(paymentsData);
      XLSX.utils.book_append_sheet(wb, ws3, 'Ödemeler');
      
      XLSX.writeFile(wb, `Dava_Yonetim_Raporu_${new Date().toLocaleDateString('tr-TR')}.xlsx`);
      showNotification('✅ Excel raporu indirildi!', 'success');
    }

    function generateFullReport() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      doc.setFont('helvetica', 'bold');
      doc.setFontSize(18);
      doc.text('DAVA YÖNETİM SİSTEMİ', 105, 20, { align: 'center' });
      doc.text('GENEL RAPOR', 105, 30, { align: 'center' });
      
      doc.setFontSize(10);
      doc.setFont('helvetica', 'normal');
      doc.text(`Rapor Tarihi: ${new Date().toLocaleDateString('tr-TR')}`, 20, 40);
      
      doc.setFontSize(14);
      doc.setFont('helvetica', 'bold');
      doc.text('ÖZET', 20, 55);
      
      doc.setFontSize(11);
      doc.setFont('helvetica', 'normal');
      doc.text(`Toplam Dava: ${cases.length}`, 20, 65);
      doc.text(`Aktif Dava: ${cases.filter(c => c.durum === 'Aktif').length}`, 20, 72);
      doc.text(`Toplam Duruşma: ${hearings.length}`, 20, 79);
      
      // Davalar tablosu
      const casesTableData = cases.slice(0, 20).map(c => [
        c.esasNo,
        c.mahkemeTuru,
        `${c.tarafAd} ${c.tarafSoyad}`,
        c.durum
      ]);
      
      doc.autoTable({
        startY: 90,
        head: [['Esas No', 'Mahkeme', 'Taraf', 'Durum']],
        body: casesTableData,
        theme: 'grid',
        headStyles: { fillColor: [99, 102, 241] }
      });
      
      doc.save(`Genel_Rapor_${new Date().toLocaleDateString('tr-TR')}.pdf`);
      showNotification('✅ PDF raporu indirildi!', 'success');
    }

    function generateHearingReport() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      doc.setFont('helvetica', 'bold');
      doc.setFontSize(18);
      doc.text('DURUŞMA TAKVİMİ RAPORU', 105, 20, { align: 'center' });
      
      doc.setFontSize(10);
      doc.setFont('helvetica', 'normal');
      doc.text(`Rapor Tarihi: ${new Date().toLocaleDateString('tr-TR')}`, 20, 35);
      doc.text(`Toplam Duruşma: ${hearings.length}`, 20, 42);
      
      const hearingsTableData = hearings.slice(0, 30).map(h => {
        const caseItem = cases.find(c => c.id === h.caseId);
        const date = new Date(h.date);
        return [
          caseItem ? caseItem.esasNo : '-',
          date.toLocaleDateString('tr-TR'),
          date.toLocaleTimeString('tr-TR', {hour: '2-digit', minute: '2-digit'}),
          h.location || '-'
        ];
      });
      
      doc.autoTable({
        startY: 50,
        head: [['Dava', 'Tarih', 'Saat', 'Yer']],
        body: hearingsTableData,
        theme: 'grid',
        headStyles: { fillColor: [99, 102, 241] }
      });
      
      doc.save(`Durusma_Raporu_${new Date().toLocaleDateString('tr-TR')}.pdf`);
      showNotification('✅ Duruşma raporu indirildi!', 'success');
    }

    function generatePaymentReport() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      doc.setFont('helvetica', 'bold');
      doc.setFontSize(18);
      doc.text('ÜCRET TAKİP RAPORU', 105, 20, { align: 'center' });
      
      let totalPaid = 0;
      let totalPending = 0;
      payments.forEach(p => {
        if (p.status === 'Tahsil Edildi') {
          totalPaid += p.amount;
        } else {
          totalPending += p.amount;
        }
      });
      
      doc.setFontSize(10);
      doc.setFont('helvetica', 'normal');
      doc.text(`Rapor Tarihi: ${new Date().toLocaleDateString('tr-TR')}`, 20, 35);
      doc.text(`Tahsil Edilen: ${totalPaid.toLocaleString('tr-TR')} TL`, 20, 42);
      doc.text(`Tahsil Bekleyen: ${totalPending.toLocaleString('tr-TR')} TL`, 20, 49);
      
      const paymentsTableData = payments.slice(0, 30).map(p => {
        const caseItem = cases.find(c => c.id === p.caseId);
        return [
          caseItem ? caseItem.esasNo : '-',
          p.type,
          `${p.amount.toLocaleString('tr-TR')} TL`,
          p.status
        ];
      });
      
      doc.autoTable({
        startY: 60,
        head: [['Dava', 'Tür', 'Tutar', 'Durum']],
        body: paymentsTableData,
        theme: 'grid',
        headStyles: { fillColor: [99, 102, 241] }
      });
      
      doc.save(`Ucret_Raporu_${new Date().toLocaleDateString('tr-TR')}.pdf`);
      showNotification('✅ Ücret raporu indirildi!', 'success');
    }

    // ==================== SETTINGS ====================
    function saveAISettings() {
      const apiKey = document.getElementById('geminiApiKey').value.trim();
      const model = document.getElementById('aiModel').value;
      
      if (!apiKey) {
        showNotification('⚠️ Lütfen API anahtarı girin!', 'warning');
        return;
      }
      
      geminiApiKey = apiKey;
      aiModel = model;
      
      localStorage.setItem('geminiApiKey', geminiApiKey);
      localStorage.setItem('aiModel', aiModel);
      
      showNotification('✅ AI ayarları kaydedildi!', 'success');
    }

    async function testAIConnection() {
      const apiKey = document.getElementById('geminiApiKey').value.trim();
      
      if (!apiKey) {
        showNotification('⚠️ Lütfen önce API anahtarı girin!', 'warning');
        return;
      }
      
      try {
        showNotification('🔄 Bağlantı test ediliyor...', 'info');
        
        const url = `https://generativelanguage.googleapis.com/v1beta/models/${aiModel}:generateContent?key=${apiKey}`;
        const response = await fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            contents: [{ parts: [{ text: 'Merhaba' }] }]
          })
        });
        
        if (response.ok) {
          showNotification('✅ Bağlantı başarılı! API çalışıyor.', 'success');
        } else {
          showNotification('❌ API anahtarı geçersiz!', 'danger');
        }
      } catch (error) {
        showNotification('❌ Bağlantı hatası!', 'danger');
      }
    }

    function backupData() {
      const backup = {
        cases: cases,
        hearings: hearings,
        payments: payments,
        reminders: reminders,
        documents: documents,
        exportDate: new Date().toISOString(),
        version: '4.5'
      };
      
      const dataStr = JSON.stringify(backup, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `Dava_Yedek_${new Date().toLocaleDateString('tr-TR')}.json`;
      link.click();
      
      showNotification('✅ Yedek alındı!', 'success');
    }

    function restoreData() {
      const file = document.getElementById('backupFile').files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const backup = JSON.parse(e.target.result);
          
          if (confirm('Mevcut veriler silinecek ve yedek yüklenecek. Emin misiniz?')) {
            cases = backup.cases || [];
            hearings = backup.hearings || [];
            payments = backup.payments || [];
            reminders = backup.reminders || [];
            documents = backup.documents || [];
            
            localStorage.setItem('cases', JSON.stringify(cases));
            localStorage.setItem('hearings', JSON.stringify(hearings));
            localStorage.setItem('payments', JSON.stringify(payments));
            localStorage.setItem('reminders', JSON.stringify(reminders));
            localStorage.setItem('documents', JSON.stringify(documents));
            
            displayCases();
            displayHearings();
            displayPayments();
            displayReminders();
            displayDocuments();
            updateDashboard();
            
            showNotification('✅ Yedek yüklendi!', 'success');
          }
        } catch (error) {
          showNotification('❌ Geçersiz yedek dosyası!', 'danger');
        }
      };
      reader.readAsText(file);
      
      document.getElementById('backupFile').value = '';
    }

    function clearAllData() {
      if (!confirm('TÜM VERİLER SİLİNECEK! Bu işlem geri alınamaz. Emin misiniz?')) return;
      if (!confirm('SON UYARI! Tüm davalar, duruşmalar, ödemeler ve belgeler silinecek. Devam edilsin mi?')) return;
      
      cases = [];
      hearings = [];
      payments = [];
      reminders = [];
      documents = [];
      
      localStorage.clear();
      
      displayCases();
      displayHearings();
      displayPayments();
      displayReminders();
      displayDocuments();
      updateDashboard();
      
      showNotification('🗑️ Tüm veriler silindi!', 'info');
    }

    // ==================== UTILITY FUNCTIONS ====================
    function switchTab(tabName) {
      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      
      document.getElementById(tabName).classList.add('active');
      event.target.classList.add('active');
      
      if (tabName === 'calendar') {
        setTimeout(initCalendar, 100);
      }
      if (tabName === 'dashboard') {
        updateDashboard();
      }
    }

    function toggleTheme() {
      document.body.classList.toggle('dark-mode');
      const icon = document.getElementById('themeIcon');
      if (document.body.classList.contains('dark-mode')) {
        icon.className = 'fas fa-sun';
        localStorage.setItem('theme', 'dark');
      } else {
        icon.className = 'fas fa-moon';
        localStorage.setItem('theme', 'light');
      }
    }

    function openModal(modalId) {
      document.getElementById(modalId).style.display = 'block';
      if (modalId === 'addHearingModal' || modalId === 'addPaymentModal' || modalId === 'addReminderModal') {
        populateCaseSelects();
      }
    }

    function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
    }

    function populateCaseSelects() {
      const selects = ['hearingCaseId', 'paymentCaseId', 'reminderCaseId'];
      selects.forEach(selectId => {
        const select = document.getElementById(selectId);
        if (select) {
          select.innerHTML = selectId === 'reminderCaseId' ? '<option value="">Genel</option>' : '<option value="">Seçin</option>';
          cases.forEach(c => {
            select.innerHTML += `<option value="${c.id}">${c.esasNo} - ${c.tarafAd} ${c.tarafSoyad}</option>`;
          });
        }
      });
    }

    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.innerHTML = `<strong>${type === 'success' ? '✅' : type === 'danger' ? '❌' : type === 'warning' ? '⚠️' : 'ℹ️'}</strong> ${message}`;
      document.body.appendChild(notification);
      setTimeout(() => notification.remove(), 4000);
    }

    // ==================== INITIALIZATION ====================
    window.addEventListener('load', function() {
      // Theme
      if (localStorage.getItem('theme') === 'dark') {
        document.body.classList.add('dark-mode');
        document.getElementById('themeIcon').className = 'fas fa-sun';
      }

      // AI Settings
      geminiApiKey = localStorage.getItem('geminiApiKey') || '';
      aiModel = localStorage.getItem('aiModel') || 'gemini-2.5-flash';
      if (geminiApiKey) {
        document.getElementById('geminiApiKey').value = geminiApiKey;
      }
      document.getElementById('aiModel').value = aiModel;

      // Display all data
      displayCases();
      displayHearings();
      displayPayments();
      displayReminders();
      displayDocuments();
      updateDashboard();

      // Notification permission
      if ('Notification' in window && Notification.permission === 'default') {
        Notification.requestPermission();
      }

      // Check reminders every minute
      setInterval(checkReminders, 60000);
      checkReminders();

      // Update upcoming hearings every 5 minutes
      setInterval(updateUpcomingHearings, 300000);

      // Modal close on outside click
      window.onclick = function(event) {
        if (event.target.classList.contains('modal')) {
          event.target.style.display = 'none';
        }
      };

      console.log('🚀 Dava Yönetim Sistemi v4.5 Ultra - Başarıyla Yüklendi!');
      console.log('📊 Toplam Dava:', cases.length);
      console.log('📅 Toplam Duruşma:', hearings.length);
      console.log('💰 Toplam Ödeme:', payments.length);
      console.log('🔔 Toplam Hatırlatıcı:', reminders.length);
      console.log('📄 Toplam Belge:', documents.length);
      
      showNotification('🎉 Sistem hazır! Hoş geldiniz.', 'success');
    });

  </script>
</body>
</html>

